<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>東京大冒險 🖍️ | Tokyo Trip</title>
    <!-- Google Fonts: 圓潤可愛手寫感字體 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800;900&display=swap" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"M PLUS Rounded 1c"', 'sans-serif'],
                    },
                    colors: {
                        draw: {
                            bg: '#FDFBF7',       // 畫紙白
                            card: '#FFFFFF',     // 純白
                            ink: '#212529',      // 馬克筆黑
                            yellow: '#FFD166',   // 向日葵黃
                            pink: '#EF476F',     // 泡泡糖粉
                            blue: '#118AB2',     // 天空藍
                            green: '#06D6A0',    // 薄荷綠
                            muted: '#6C757D'     // 鉛筆灰
                        }
                    },
                    boxShadow: {
                        'draw': '4px 4px 0px 0px #212529',       // 手繪感實色陰影
                        'draw-sm': '2px 2px 0px 0px #212529',    // 小實色陰影
                        'draw-pressed': '0px 0px 0px 0px #212529', // 點擊時陰影消失
                    }
                }
            }
        }
    </script>
    <style>
        /* 隱藏滾動條但保持可滾動 */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        /* 點陣背景，端正不歪斜 */
        body { -webkit-tap-highlight-color: transparent; background-image: radial-gradient(#E9ECEF 1.5px, transparent 1.5px); background-size: 24px 24px; }
        
        /* 漸顯動畫 */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
        
        /* 導航列安全區域 (iOS) */
        .pb-safe { padding-bottom: env(safe-area-inset-bottom, 16px); }

        /* 按鈕點擊手感 */
        .draw-btn { transition: all 0.1s; }
        .draw-btn:active {
            transform: translate(4px, 4px);
            box-shadow: 0px 0px 0px 0px #212529 !important;
        }
    </style>
</head>
<body class="bg-draw-bg text-draw-ink font-sans antialiased h-screen flex flex-col overflow-hidden w-full m-0 p-0">

    <!-- Header (塗鴉標題滿版) -->
    <header class="bg-draw-yellow border-b-[4px] border-draw-ink pt-14 pb-5 px-6 flex justify-between items-end shrink-0 z-20 relative overflow-hidden w-full">
        <div class="relative z-10">
            <h1 class="text-3xl font-black tracking-wider text-draw-ink drop-shadow-md">東京大冒險 🇯🇵</h1>
            <p class="text-[11px] font-bold text-white mt-1.5 tracking-widest bg-draw-pink inline-block px-3 py-1 rounded-full border-[3px] border-draw-ink shadow-draw-sm">TOKYO 2026</p>
        </div>
        <div class="text-right relative z-10">
            <div class="bg-white border-[3px] border-draw-ink px-3 py-2 rounded-xl shadow-draw-sm flex items-center">
                <i class="fa-solid fa-calendar-day text-draw-blue mr-2 text-lg"></i>
                <span class="text-xs font-black tracking-wide">Mar 12</span>
            </div>
        </div>
        <!-- 裝飾背景圈圈 -->
        <div class="absolute -right-6 -top-6 w-24 h-24 bg-white opacity-30 rounded-full"></div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-1 overflow-y-auto no-scrollbar pb-32 relative z-10 w-full" id="main-content">
        
        <!-- ==================== TAB 1: PLAN (行程表) ==================== -->
        <section id="tab-plan" class="p-5 fade-in space-y-6">
            
            <!-- 綜合預訂資訊卡片 (端正版) -->
            <div class="bg-white border-[3px] border-draw-ink rounded-2xl p-5 shadow-draw relative mt-3">
                <div class="absolute -top-4 left-5 bg-draw-blue text-white text-[11px] px-4 py-1.5 font-black rounded-lg border-[3px] border-draw-ink shadow-draw-sm">訂單傳送門 📌</div>
                
                <div class="mb-4 mt-2 border-b-2 border-dashed border-gray-300 pb-3">
                    <span class="text-[10px] font-black bg-draw-yellow text-draw-ink border-2 border-draw-ink px-2 py-0.5 rounded-md inline-block mb-1.5">D1 住宿</span>
                    <p class="text-sm font-black tracking-wide text-draw-blue">迪士尼玩具總動員飯店 🚀</p>
                    <div class="flex justify-between items-end mt-1.5">
                        <p class="text-[10px] font-bold text-draw-muted">訂單: 381255209 | 標準客房x2</p>
                        <a href="https://maps.app.goo.gl/W6mGkV7jYRyRj9j16" target="_blank" class="text-[10px] text-draw-ink bg-draw-yellow border-2 border-draw-ink px-2.5 py-1 rounded-md font-black draw-btn"><i class="fa-solid fa-map-location-dot mr-1"></i>地圖</a>
                    </div>
                </div>
                
                <div class="mb-4 border-b-2 border-dashed border-gray-300 pb-3">
                    <span class="text-[10px] font-black bg-draw-green text-draw-ink border-2 border-draw-ink px-2 py-0.5 rounded-md inline-block mb-1.5">D2-D5 住宿</span>
                    <p class="text-sm font-black tracking-wide text-draw-green">Airbnb 溫馨小窩 🏠</p>
                    <div class="flex justify-between items-end mt-1.5">
                        <p class="text-[10px] font-bold text-draw-muted w-3/4 leading-tight">3 Chome-7-5 Narihira, Sumida-ku</p>
                        <a href="https://maps.google.com/?q=3+Chome-7-5+Narihira,+Sumida-ku,+Tokyo" target="_blank" class="text-[10px] text-draw-ink bg-draw-green border-2 border-draw-ink px-2.5 py-1 rounded-md font-black draw-btn"><i class="fa-solid fa-map-location-dot mr-1"></i>地圖</a>
                    </div>
                </div>

                <div>
                    <span class="text-[10px] font-black bg-draw-pink text-white border-2 border-draw-ink px-2 py-0.5 rounded-md inline-block mb-1.5">3/14 20:00 - 3/15 19:00</span>
                    <p class="text-sm font-black tracking-wide text-draw-pink">TOYOTA 租車 (吾妻橋店) 🚗</p>
                    <div class="flex justify-between items-end mt-1.5">
                        <p class="text-[10px] font-bold text-draw-muted">預約: 98163450600 (郭語安)</p>
                        <a href="https://maps.google.com/?q=トヨタレンタカー吾妻橋店" target="_blank" class="text-[10px] text-draw-ink bg-draw-pink border-2 border-draw-ink px-2.5 py-1 rounded-md font-black draw-btn"><i class="fa-solid fa-map-location-dot mr-1"></i>地圖</a>
                    </div>
                </div>
            </div>

            <!-- 每日切換標籤列 (端正滿版大積木) -->
            <div class="sticky top-0 z-10 bg-draw-bg/95 backdrop-blur-md pt-3 pb-4 -mx-5 px-5 border-b-[3px] border-dashed border-gray-300">
                <div class="flex overflow-x-auto no-scrollbar space-x-3 pb-2 pt-1 px-1">
                    <button onclick="switchPlanDay(1)" id="btn-d1" class="plan-day-btn shrink-0 w-16 h-12 rounded-xl font-black text-sm border-[3px] border-draw-ink transition-all bg-draw-yellow text-draw-ink shadow-draw-pressed translate-y-[4px]">D1</button>
                    <button onclick="switchPlanDay(2)" id="btn-d2" class="plan-day-btn shrink-0 w-16 h-12 rounded-xl font-black text-sm border-[3px] border-draw-ink transition-all bg-white text-draw-ink shadow-draw hover:bg-gray-100">D2</button>
                    <button onclick="switchPlanDay(3)" id="btn-d3" class="plan-day-btn shrink-0 w-16 h-12 rounded-xl font-black text-sm border-[3px] border-draw-ink transition-all bg-white text-draw-ink shadow-draw hover:bg-gray-100">D3</button>
                    <button onclick="switchPlanDay(4)" id="btn-d4" class="plan-day-btn shrink-0 w-16 h-12 rounded-xl font-black text-sm border-[3px] border-draw-ink transition-all bg-white text-draw-ink shadow-draw hover:bg-gray-100">D4</button>
                    <button onclick="switchPlanDay(5)" id="btn-d5" class="plan-day-btn shrink-0 w-16 h-12 rounded-xl font-black text-sm border-[3px] border-draw-ink transition-all bg-white text-draw-ink shadow-draw hover:bg-gray-100">D5</button>
                    <button onclick="switchPlanDay(6)" id="btn-d6" class="plan-day-btn shrink-0 w-16 h-12 rounded-xl font-black text-sm border-[3px] border-draw-ink transition-all bg-white text-draw-ink shadow-draw hover:bg-gray-100">D6</button>
                </div>
            </div>

            <!-- ================= Day 1 ================= -->
            <div id="plan-d1" class="plan-day-content fade-in">
                <div class="flex items-center mb-6 bg-white border-[3px] border-draw-ink px-4 py-2.5 rounded-xl w-max shadow-draw">
                    <span class="text-sm font-black text-draw-blue"><i class="fa-solid fa-plane-arrival mr-2"></i>Day 1: 啟程與台場</span>
                </div>
                
                <div class="relative border-l-[4px] border-draw-ink ml-5 space-y-8 pb-4">
                    
                    <div class="relative pl-6">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-draw-pink rounded-full border-[3px] border-draw-ink"></div>
                        <div class="bg-[#FFE5EC] border-[3px] border-draw-ink rounded-2xl p-4 shadow-draw relative">
                            <div class="flex justify-between items-start">
                                <h3 class="font-black text-draw-pink text-sm">機場專車接送 🚗</h3>
                                <span class="font-black text-white bg-draw-pink border-2 border-draw-ink px-2.5 py-1 rounded-lg text-xs shadow-draw-sm">03:30</span>
                            </div>
                            <p class="text-xs font-bold text-draw-ink mt-3 bg-white inline-block px-2.5 py-1 rounded-lg border-2 border-draw-ink"><i class="fa-solid fa-passport text-draw-pink mr-1.5"></i>護照帶了沒？！</p>
                        </div>
                    </div>
                    
                    <div class="relative pl-6">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-draw-yellow rounded-full border-[3px] border-draw-ink"></div>
                        <div class="bg-white border-[3px] border-draw-ink rounded-2xl p-4 shadow-draw">
                            <h3 class="font-black text-draw-ink text-sm mb-1">搭乘 TR898 航班 ✈️</h3>
                            <p class="text-xs font-bold text-draw-muted">桃園 T1 出發 ➔ <span class="text-draw-blue font-black underline decoration-[3px] decoration-draw-blue">06:40 抵達</span>成田</p>
                        </div>
                    </div>
                    
                    <div class="relative pl-6">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-draw-blue rounded-full border-[3px] border-draw-ink"></div>
                        <div class="bg-white border-[3px] border-draw-ink rounded-2xl p-4 shadow-draw">
                            <h3 class="font-black text-draw-blue text-sm mb-2">台場商圈 & teamLab 🎨</h3>
                            <p class="text-xs font-bold text-draw-muted leading-relaxed mb-4">先寄放行李！逛台場吃午餐，準備沉浸在 teamLab 的光影世界裡。</p>
                            
                            <div class="bg-[#E8F6FA] border-[3px] border-draw-ink p-4 rounded-xl border-dashed">
                                <p class="font-black text-draw-blue mb-2.5 text-xs"><i class="fa-solid fa-ticket mr-1"></i> teamLab 票價參考</p>
                                <ul class="font-bold text-draw-ink space-y-1.5 mb-4 text-[11px]">
                                    <li><i class="fa-solid fa-star text-draw-yellow mr-1.5 text-[10px]"></i> 成人: 約 ¥3,800 - ¥4,200</li>
                                    <li><i class="fa-solid fa-star text-draw-yellow mr-1.5 text-[10px]"></i> 學生/兒童: 約 ¥1,500 - ¥2,800</li>
                                </ul>
                                <a href="https://www.klook.com/zh-TW/activity/25300-teamlab-planets-toyosu-tokyo-ticket/" target="_blank" class="block text-center bg-draw-yellow text-draw-ink font-black rounded-xl py-3 border-[3px] border-draw-ink shadow-draw-sm draw-btn text-xs tracking-wide">
                                    🛒 Klook 購票傳送門
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="relative pl-6">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-draw-green rounded-full border-[3px] border-draw-ink"></div>
                        <div class="bg-white border-[3px] border-draw-ink rounded-2xl p-4 shadow-draw">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-black text-draw-green text-sm">飯店 Check-in 🏨</h3>
                                <span class="font-black text-draw-ink bg-draw-green text-white border-2 border-draw-ink px-2.5 py-1 rounded-lg text-xs shadow-draw-sm">15:00</span>
                            </div>
                            <p class="text-xs font-bold text-draw-muted leading-relaxed mb-4">入住超可愛玩具總動員飯店。視體力決定是否買傍晚票進樂園看夜間遊行與煙火 🎆</p>
                            
                            <div class="bg-draw-bg border-2 border-draw-ink p-3 rounded-xl">
                                <p class="font-black text-draw-ink text-xs mb-2"><i class="fa-regular fa-star text-draw-pink text-sm mr-1.5"></i> 迪士尼星光票價</p>
                                <ul class="text-[11px] font-bold text-draw-muted space-y-1.5">
                                    <li class="flex justify-between"><span>假日 (15:00起)</span> <span class="text-draw-ink font-black">¥6,500-¥8,700</span></li>
                                    <li class="flex justify-between border-t border-dashed border-gray-300 pt-1.5"><span>平日 (17:00起)</span> <span class="text-draw-ink font-black">¥4,500-¥6,200</span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ================= Day 2 ================= -->
            <div id="plan-d2" class="plan-day-content hidden fade-in">
                <div class="flex items-center mb-6 bg-white border-[3px] border-draw-ink px-4 py-2.5 rounded-xl w-max shadow-draw">
                    <span class="text-sm font-black text-draw-pink"><i class="fa-solid fa-wand-magic-sparkles mr-2"></i>Day 2: 迪士尼夢幻日</span>
                </div>
                <div class="relative border-l-[4px] border-draw-ink ml-5 space-y-8 pb-4">
                    
                    <div class="relative pl-6">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-draw-red rounded-full border-[3px] border-draw-ink"></div>
                        <div class="bg-white border-[3px] border-draw-ink rounded-2xl p-4 shadow-draw">
                            <div class="flex justify-between items-start">
                                <h3 class="font-black text-draw-ink text-sm">抵達園區門口 🏰</h3>
                                <span class="font-black text-draw-pink bg-[#FFE5EC] border-2 border-draw-ink px-2.5 py-1 rounded-lg text-xs shadow-draw-sm">08:00 前</span>
                            </div>
                            <p class="text-xs font-bold text-draw-muted mt-2">務必提早抵達，準備使用特權提早入園！</p>
                        </div>
                    </div>
                    
                    <div class="relative pl-6">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-draw-yellow rounded-full border-[3px] border-draw-ink"></div>
                        <div class="bg-white border-[3px] border-draw-ink rounded-2xl p-5 shadow-draw">
                            <div class="flex justify-between items-start mb-3">
                                <h3 class="font-black text-draw-ink text-sm">Happy Entry 入園 🏃‍♂️</h3>
                                <span class="font-black text-draw-ink bg-draw-yellow border-2 border-draw-ink px-2.5 py-1 rounded-lg text-xs shadow-draw-sm">08:30-08:45</span>
                            </div>
                            <p class="text-xs font-bold text-draw-muted mb-4 leading-relaxed">Disney Land 全日遊。入園後請立即開啟官方 APP 抽取 Standby Pass 或購買 DPA。</p>
                            
                            <!-- 必玩設施 -->
                            <div class="bg-[#FFF8E7] border-[3px] border-draw-ink p-4 rounded-xl mb-5">
                                <p class="text-xs font-black text-draw-ink mb-3"><i class="fa-solid fa-flag text-draw-pink mr-1.5 text-lg"></i> 鎖定必玩設施：</p>
                                <ul class="text-xs font-bold text-draw-ink space-y-3">
                                    <li class="flex items-center bg-white border-2 border-draw-ink p-2 rounded-lg shadow-draw-sm">👑 美女與野獸 <span class="text-[9px] text-white bg-draw-pink px-2 py-0.5 rounded-md ml-auto border-2 border-draw-ink">建議買DPA</span></li>
                                    <li class="flex items-center bg-white border-2 border-draw-ink p-2 rounded-lg shadow-draw-sm">💦 飛濺山 <span class="text-[10px] text-draw-muted ml-auto font-black">獨木舟</span></li>
                                    <li class="flex items-center bg-white border-2 border-draw-ink p-2 rounded-lg shadow-draw-sm">🚂 巨雷山 <span class="text-[10px] text-draw-muted ml-auto font-black">礦車</span></li>
                                </ul>
                            </div>

                            <!-- 攻略連結 -->
                            <button onclick="switchTab('guide')" class="w-full bg-draw-blue text-white font-black rounded-xl py-3.5 border-[3px] border-draw-ink shadow-draw draw-btn text-sm tracking-wide">
                                偷看攻略秘笈 📖
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ================= Day 3 ================= -->
            <div id="plan-d3" class="plan-day-content hidden fade-in">
                <div class="flex items-center mb-6 bg-white border-[3px] border-draw-ink px-4 py-2.5 rounded-xl w-max shadow-draw">
                    <span class="text-sm font-black text-draw-ink"><i class="fa-solid fa-bag-shopping mr-2 text-draw-yellow"></i>Day 3: 時尚與街頭</span>
                </div>
                
                <div class="relative border-l-[4px] border-draw-ink ml-5 pb-4">
                    
                    <!-- D3: 豪德寺 -->
                    <div class="relative pl-6 pb-2">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-white border-[3px] border-draw-ink rounded-full"></div>
                        <div class="bg-white border-[3px] border-draw-ink rounded-2xl p-4 shadow-draw">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-black text-draw-ink text-sm">出發 ➔ 豪德寺 🐾</h3>
                                <span class="font-black text-draw-ink bg-gray-100 border-2 border-draw-ink px-2.5 py-1 rounded-lg text-xs shadow-draw-sm">08:30</span>
                            </div>
                            <p class="text-xs font-bold text-draw-muted">尋找滿滿的招財貓發源地。</p>
                        </div>
                    </div>

                    <!-- 交通時間裝飾 -->
                    <div class="pl-8 py-3.5 text-xs font-black text-draw-blue flex items-center">
                        <div class="bg-[#E8F6FA] border-[3px] border-draw-ink px-3 py-1.5 rounded-xl shadow-draw-sm flex items-center">
                            <i class="fa-solid fa-train-subway mr-2 text-lg"></i> 約 45-50 分鐘
                        </div>
                    </div>

                    <!-- D3: 原宿/表參道 -->
                    <div class="relative pl-6 py-2">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-draw-yellow border-[3px] border-draw-ink rounded-full"></div>
                        <div class="bg-white border-[3px] border-draw-ink rounded-2xl p-5 shadow-draw">
                            <h3 class="font-black text-draw-ink text-base mb-2 bg-draw-yellow inline-block px-2">原宿 / 青山 / 表參道 🛍️</h3>
                            <p class="text-xs font-bold text-draw-muted mb-4 mt-2">東京潮流與精品匯聚之地。今日鎖定目標：</p>
                            
                            <!-- 重點品牌區塊 -->
                            <div class="bg-draw-bg border-[3px] border-draw-ink p-4 rounded-2xl space-y-3.5 text-xs font-black text-draw-ink shadow-inner">
                                <div class="flex justify-between items-center bg-white border-[3px] border-draw-ink p-2.5 rounded-xl shadow-draw-sm">
                                    <span class="flex items-center"><i class="fa-solid fa-gem text-draw-pink w-5 text-center mr-1"></i> CHANEL <span class="text-[10px] text-draw-muted ml-1.5 hidden sm:inline">(表參道)</span></span>
                                    <a href="https://maps.google.com/?q=CHANEL+Omotesando" target="_blank" class="bg-draw-yellow border-[3px] border-draw-ink px-2.5 py-1 rounded-lg shadow-draw-sm draw-btn text-[11px]"><i class="fa-solid fa-map-location-dot"></i> 地圖</a>
                                </div>
                                <div class="flex justify-between items-center bg-white border-[3px] border-draw-ink p-2.5 rounded-xl shadow-draw-sm">
                                    <span class="flex items-center"><i class="fa-solid fa-crown text-draw-yellow w-5 text-center mr-1"></i> Vivienne W. <span class="text-[10px] text-draw-muted ml-1.5 hidden sm:inline">(青山)</span></span>
                                    <a href="https://maps.google.com/?q=Vivienne+Westwood+Aoyama" target="_blank" class="bg-draw-yellow border-[3px] border-draw-ink px-2.5 py-1 rounded-lg shadow-draw-sm draw-btn text-[11px]"><i class="fa-solid fa-map-location-dot"></i> 地圖</a>
                                </div>
                                <div class="flex justify-between items-center bg-white border-[3px] border-draw-ink p-2.5 rounded-xl shadow-draw-sm">
                                    <span class="flex items-center"><i class="fa-solid fa-heart text-draw-green w-5 text-center mr-1"></i> HUMAN MADE <span class="text-[10px] text-draw-muted ml-1.5 hidden sm:inline">(原宿)</span></span>
                                    <a href="https://maps.google.com/?q=HUMAN+MADE+OFFLINE+STORE" target="_blank" class="bg-draw-yellow border-[3px] border-draw-ink px-2.5 py-1 rounded-lg shadow-draw-sm draw-btn text-[11px]"><i class="fa-solid fa-map-location-dot"></i> 地圖</a>
                                </div>
                                <div class="flex justify-between items-center bg-white border-[3px] border-draw-ink p-2.5 rounded-xl shadow-draw-sm">
                                    <span class="flex items-center"><i class="fa-solid fa-clock text-draw-blue w-5 text-center mr-1"></i> Rolex <span class="text-[10px] text-draw-muted ml-1.5 hidden sm:inline">(表參道)</span></span>
                                    <a href="https://maps.google.com/?q=Rolex+Omotesando" target="_blank" class="bg-draw-yellow border-[3px] border-draw-ink px-2.5 py-1 rounded-lg shadow-draw-sm draw-btn text-[11px]"><i class="fa-solid fa-map-location-dot"></i> 地圖</a>
                                </div>
                                <div class="flex justify-between items-center bg-white border-[3px] border-draw-ink p-2.5 rounded-xl shadow-draw-sm">
                                    <span class="flex items-center"><i class="fa-solid fa-bowl-food text-draw-ink w-5 text-center mr-1"></i> 一蘭拉麵 <span class="text-[10px] text-draw-muted ml-1.5 hidden sm:inline">(原宿)</span></span>
                                    <a href="https://maps.google.com/?q=一蘭+原宿" target="_blank" class="bg-draw-yellow border-[3px] border-draw-ink px-2.5 py-1 rounded-lg shadow-draw-sm draw-btn text-[11px]"><i class="fa-solid fa-map-location-dot"></i> 地圖</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 交通時間裝飾 -->
                    <div class="pl-8 py-3.5 text-xs font-black text-draw-green flex items-center">
                        <div class="bg-[#E6F7EB] border-[3px] border-draw-ink px-3 py-1.5 rounded-xl shadow-draw-sm flex items-center">
                            <i class="fa-solid fa-person-walking mr-2 text-lg"></i> 步行或短程地鐵
                        </div>
                    </div>

                    <!-- D3: 唐橋桌球 -->
                    <div class="relative pl-6 py-2">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-white border-[3px] border-draw-ink rounded-full"></div>
                        <div class="bg-white border-[3px] border-draw-ink rounded-2xl p-4 shadow-draw">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-black text-draw-ink text-sm">唐橋桌球 (代代木) 🏓</h3>
                                <span class="font-black text-draw-ink bg-draw-green text-white border-2 border-draw-ink px-2 py-0.5 rounded-lg text-[10px] shadow-draw-sm">10:00-19:00</span>
                            </div>
                            <p class="text-xs font-bold text-draw-muted">專業桌球用品朝聖地，請備妥護照辦理免稅。</p>
                        </div>
                    </div>

                    <!-- 交通時間裝飾 -->
                    <div class="pl-8 py-3.5 text-xs font-black text-draw-blue flex items-center">
                        <div class="bg-[#E8F6FA] border-[3px] border-draw-ink px-3 py-1.5 rounded-xl shadow-draw-sm flex items-center">
                            <i class="fa-solid fa-train-subway mr-2 text-lg"></i> 約 5 分鐘 (JR)
                        </div>
                    </div>

                    <!-- D3: 澀谷 -->
                    <div class="relative pl-6 py-2">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-draw-blue border-[3px] border-draw-ink rounded-full"></div>
                        <div class="bg-white border-[3px] border-draw-ink rounded-2xl p-4 shadow-draw">
                            <h3 class="font-black text-draw-ink text-sm mb-2">澀谷 & SHIBUYA SKY 🌃</h3>
                            <p class="text-xs font-bold text-draw-muted">欣賞無敵百萬夜景 (需留意預約時段)。</p>
                        </div>
                    </div>

                    <!-- 交通時間裝飾 -->
                    <div class="pl-8 py-3.5 text-xs font-black text-draw-blue flex items-center">
                        <div class="bg-[#E8F6FA] border-[3px] border-draw-ink px-3 py-1.5 rounded-xl shadow-draw-sm flex items-center">
                            <i class="fa-solid fa-train-subway mr-2 text-lg"></i> 約 35-45 分 (往吾妻橋)
                        </div>
                    </div>

                    <!-- D3: 取車 -->
                    <div class="relative pl-6 pt-2">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-draw-green border-[3px] border-draw-ink rounded-full"></div>
                        <div class="bg-draw-ink text-white border-[3px] border-draw-ink p-4 rounded-2xl shadow-draw">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-black text-white text-sm">前往取車 (TOYOTA) 🚙</h3>
                                <span class="font-black text-draw-ink bg-draw-yellow border-2 border-draw-ink px-2.5 py-1 rounded-lg text-xs shadow-draw-sm">20:00</span>
                            </div>
                            <p class="text-xs font-bold text-gray-300 mt-2">TOYOTA 吾妻橋店。取車後直接開車返回 Airbnb 休息。</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ================= Day 4 ================= -->
            <div id="plan-d4" class="plan-day-content hidden fade-in">
                <div class="flex items-center mb-6 bg-white border-[3px] border-draw-ink px-4 py-2.5 rounded-xl w-max shadow-draw">
                    <span class="text-sm font-black text-draw-green"><i class="fa-solid fa-mountain mr-2"></i>Day 4: 河口湖自駕</span>
                </div>
                <div class="relative border-l-[4px] border-draw-ink ml-5 pb-4">
                    
                    <!-- D4: 出發 -->
                    <div class="relative pl-6 pb-2">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-draw-pink border-[3px] border-draw-ink rounded-full"></div>
                        <div class="bg-[#FFE5EC] border-[3px] border-draw-ink p-4 rounded-2xl shadow-draw">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-black text-draw-ink text-sm">出發前往河口湖</h3>
                                <span class="font-black text-draw-ink bg-white border-2 border-draw-ink px-2.5 py-1 rounded-lg text-xs shadow-draw-sm">06:30</span>
                            </div>
                            <p class="text-xs font-bold text-draw-ink mt-3 bg-white inline-block px-3 py-1.5 rounded-lg border-[3px] border-draw-ink"><i class="fa-solid fa-clock text-draw-pink mr-1.5"></i>務必早起，避開車潮！</p>
                        </div>
                    </div>

                    <!-- 交通時間裝飾 -->
                    <div class="pl-8 py-3.5 text-xs font-black text-draw-green flex items-center">
                        <div class="bg-[#E6F7EB] border-[3px] border-draw-ink px-3 py-1.5 rounded-xl shadow-draw-sm flex items-center">
                            <i class="fa-solid fa-car mr-2 text-lg"></i> 約 1.5 - 2 小時
                        </div>
                    </div>

                    <!-- D4: 河口湖 -->
                    <div class="relative pl-6 py-2">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-white border-[3px] border-draw-ink rounded-full"></div>
                        <div class="bg-white border-[3px] border-draw-ink p-4 rounded-2xl shadow-draw">
                            <h3 class="font-black text-draw-ink text-base mb-2 bg-draw-green text-white inline-block px-2">河口湖一日遊 🗻</h3>
                            <p class="text-xs font-bold text-draw-muted mt-2">河口湖周邊景點。留意左駕習慣與收費站。</p>
                        </div>
                    </div>
                    
                    <!-- 交通時間裝飾 -->
                    <div class="pl-8 py-3.5 text-xs font-black text-draw-green flex items-center">
                        <div class="bg-[#E6F7EB] border-[3px] border-draw-ink px-3 py-1.5 rounded-xl shadow-draw-sm flex items-center">
                            <i class="fa-solid fa-car mr-2 text-lg"></i> 約 1.5 小時 (往南町田)
                        </div>
                    </div>

                    <!-- D4: 晚餐 -->
                    <div class="relative pl-6 py-2">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-draw-yellow border-[3px] border-draw-ink rounded-full"></div>
                        <div class="bg-white border-[3px] border-draw-ink p-4 rounded-2xl shadow-draw">
                            <h3 class="font-black text-draw-ink text-sm mb-2">晚餐：AFURI 拉麵 🍜</h3>
                            <p class="text-xs font-bold text-draw-muted">南町田 Grandberry Park 店，享用清爽的柚子鹽拉麵。</p>
                        </div>
                    </div>
                    
                    <!-- 交通時間裝飾 -->
                    <div class="pl-8 py-3.5 text-xs font-black text-draw-green flex items-center">
                        <div class="bg-[#E6F7EB] border-[3px] border-draw-ink px-3 py-1.5 rounded-xl shadow-draw-sm flex items-center">
                            <i class="fa-solid fa-car mr-2 text-lg"></i> 約 1 小時 (回吾妻橋)
                        </div>
                    </div>

                    <!-- D4: 還車 -->
                    <div class="relative pl-6 pt-2">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-draw-blue border-[3px] border-draw-ink rounded-full"></div>
                        <div class="bg-[#E8F6FA] border-[3px] border-draw-ink p-4 rounded-2xl shadow-draw">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-black text-draw-blue text-sm">還車 (TOYOTA)</h3>
                                <span class="font-black text-white bg-draw-ink border-2 border-draw-ink px-2.5 py-1 rounded-lg text-xs shadow-draw-sm">19:00 前</span>
                            </div>
                            <p class="text-xs font-bold text-draw-ink mt-3 bg-white inline-block px-3 py-1.5 rounded-lg border-[3px] border-draw-ink"><i class="fa-solid fa-gas-pump text-draw-pink mr-1.5"></i>還車前記得加滿油！</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ================= Day 5 ================= -->
            <div id="plan-d5" class="plan-day-content hidden fade-in">
                <div class="flex items-center mb-6 bg-white border-[3px] border-draw-ink px-4 py-2.5 rounded-xl w-max shadow-draw">
                    <span class="text-sm font-black text-draw-ink"><i class="fa-solid fa-star mr-2 text-draw-yellow"></i>Day 5: 經典與精品</span>
                </div>
                <div class="relative border-l-[4px] border-draw-ink ml-5 pb-4">
                    
                    <!-- D5: 淺草寺 -->
                    <div class="relative pl-6 pb-2">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-draw-pink border-[3px] border-draw-ink rounded-full"></div>
                        <div class="bg-white border-[3px] border-draw-ink p-4 rounded-2xl shadow-draw">
                            <h3 class="font-black text-draw-ink text-sm mb-2">淺草寺 🏮</h3>
                            <p class="text-xs font-bold text-draw-muted">雷門地標拍照，仲見世通吃吃喝喝。</p>
                        </div>
                    </div>

                    <!-- 交通時間裝飾 -->
                    <div class="pl-8 py-3.5 text-xs font-black text-draw-blue flex items-center">
                        <div class="bg-[#E8F6FA] border-[3px] border-draw-ink px-3 py-1.5 rounded-xl shadow-draw-sm flex items-center">
                            <i class="fa-solid fa-train-subway mr-2 text-lg"></i> 約 10-15 分鐘
                        </div>
                    </div>

                    <!-- D5: 秋葉原 -->
                    <div class="relative pl-6 py-2">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-white border-[3px] border-draw-ink rounded-full"></div>
                        <div class="bg-white border-[3px] border-draw-ink p-4 rounded-2xl shadow-draw">
                            <h3 class="font-black text-draw-ink text-sm mb-2">秋葉原 👾</h3>
                            <p class="text-xs font-bold text-draw-muted">動漫周邊、電器與扭蛋巡禮。</p>
                        </div>
                    </div>

                    <!-- 交通時間裝飾 -->
                    <div class="pl-8 py-3.5 text-xs font-black text-draw-blue flex items-center">
                        <div class="bg-[#E8F6FA] border-[3px] border-draw-ink px-3 py-1.5 rounded-xl shadow-draw-sm flex items-center">
                            <i class="fa-solid fa-train-subway mr-2 text-lg"></i> 約 5 分鐘
                        </div>
                    </div>

                    <!-- D5: 東京車站/銀座 -->
                    <div class="relative pl-6 pt-2">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-draw-yellow border-[3px] border-draw-ink rounded-full"></div>
                        <div class="bg-white border-[3px] border-draw-ink p-5 rounded-2xl shadow-draw">
                            <h3 class="font-black text-draw-ink text-base mb-2 bg-draw-yellow inline-block px-2">東京車站 ➔ 銀座 🏢</h3>
                            <p class="text-xs font-bold text-draw-muted mb-4 leading-relaxed mt-2">車站地下街採買伴手禮，午後漫步銀座感受高檔都會氛圍。</p>

                            <!-- 逛街重點品牌區塊 (銀座) -->
                            <div class="bg-draw-bg border-[3px] border-draw-ink p-4 rounded-2xl space-y-3.5 text-xs font-black text-draw-ink shadow-inner">
                                <p class="text-sm text-draw-pink mb-2 border-b-2 border-draw-ink/20 pb-1.5"><i class="fa-solid fa-map-pin mr-1.5"></i> 銀座鎖定目標：</p>
                                <div class="flex justify-between items-center bg-white border-[3px] border-draw-ink p-2.5 rounded-xl shadow-draw-sm">
                                    <span class="flex items-center"><i class="fa-solid fa-gem text-draw-pink w-5 text-center mr-1"></i> CHANEL <span class="text-[10px] text-draw-muted ml-1.5 hidden sm:inline">(銀座)</span></span>
                                    <a href="https://maps.google.com/?q=CHANEL+Ginza" target="_blank" class="bg-draw-yellow border-[3px] border-draw-ink px-2.5 py-1 rounded-lg shadow-draw-sm draw-btn text-[11px]"><i class="fa-solid fa-map-location-dot"></i> 地圖</a>
                                </div>
                                <div class="flex justify-between items-center bg-white border-[3px] border-draw-ink p-2.5 rounded-xl shadow-draw-sm">
                                    <span class="flex items-center"><i class="fa-solid fa-crown text-draw-yellow w-5 text-center mr-1"></i> Vivienne W. <span class="text-[10px] text-draw-muted ml-1.5 hidden sm:inline">(GINZA SIX)</span></span>
                                    <a href="https://maps.google.com/?q=Vivienne+Westwood+GINZA+SIX" target="_blank" class="bg-draw-yellow border-[3px] border-draw-ink px-2.5 py-1 rounded-lg shadow-draw-sm draw-btn text-[11px]"><i class="fa-solid fa-map-location-dot"></i> 地圖</a>
                                </div>
                                <div class="flex justify-between items-center bg-white border-[3px] border-draw-ink p-2.5 rounded-xl shadow-draw-sm">
                                    <span class="flex items-center"><i class="fa-solid fa-heart text-draw-green w-5 text-center mr-1"></i> HUMAN MADE <span class="text-[10px] text-draw-muted ml-1.5 hidden sm:inline">(DSM)</span></span>
                                    <a href="https://maps.google.com/?q=Dover+Street+Market+Ginza" target="_blank" class="bg-draw-yellow border-[3px] border-draw-ink px-2.5 py-1 rounded-lg shadow-draw-sm draw-btn text-[11px]"><i class="fa-solid fa-map-location-dot"></i> 地圖</a>
                                </div>
                                <div class="flex justify-between items-center bg-white border-[3px] border-draw-ink p-2.5 rounded-xl shadow-draw-sm">
                                    <span class="flex items-center"><i class="fa-solid fa-clock text-draw-blue w-5 text-center mr-1"></i> Rolex <span class="text-[10px] text-draw-muted ml-1.5 hidden sm:inline">(銀座)</span></span>
                                    <a href="https://maps.google.com/?q=Rolex+Ginza" target="_blank" class="bg-draw-yellow border-[3px] border-draw-ink px-2.5 py-1 rounded-lg shadow-draw-sm draw-btn text-[11px]"><i class="fa-solid fa-map-location-dot"></i> 地圖</a>
                                </div>
                                <div class="flex justify-between items-center bg-white border-[3px] border-draw-ink p-2.5 rounded-xl shadow-draw-sm">
                                    <span class="flex items-center"><i class="fa-solid fa-bowl-food text-draw-ink w-5 text-center mr-1"></i> 一蘭拉麵 <span class="text-[10px] text-draw-muted ml-1.5 hidden sm:inline">(銀座)</span></span>
                                    <a href="https://maps.google.com/?q=一蘭+銀座" target="_blank" class="bg-draw-yellow border-[3px] border-draw-ink px-2.5 py-1 rounded-lg shadow-draw-sm draw-btn text-[11px]"><i class="fa-solid fa-map-location-dot"></i> 地圖</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ================= Day 6 ================= -->
            <div id="plan-d6" class="plan-day-content hidden fade-in">
                <div class="flex items-center mb-6 bg-white border-[3px] border-draw-ink px-4 py-2.5 rounded-xl w-max shadow-draw">
                    <span class="text-sm font-black text-draw-ink"><i class="fa-solid fa-house mr-2 text-draw-blue"></i>Day 6: 平安歸途</span>
                </div>
                <div class="relative border-l-[4px] border-draw-ink ml-5 space-y-8 pb-4">
                    <div class="relative pl-6">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-white border-[3px] border-draw-ink rounded-full"></div>
                        <div class="bg-white border-[3px] border-draw-ink rounded-2xl p-4 shadow-draw">
                            <div class="flex justify-between items-start">
                                <h3 class="font-black text-draw-ink text-sm">起床 & 退房 🧳</h3>
                                <span class="font-black text-draw-ink bg-gray-200 border-2 border-draw-ink px-2.5 py-1 rounded-lg text-xs shadow-draw-sm">09:00</span>
                            </div>
                            <p class="text-xs font-bold text-draw-muted mt-2">最後確認行李，搭乘機場接送專車前往成田機場。</p>
                        </div>
                    </div>
                    
                    <div class="relative pl-6">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-draw-blue border-[3px] border-draw-ink rounded-full"></div>
                        <div class="bg-[#E8F6FA] border-[3px] border-draw-ink rounded-2xl p-4 shadow-draw">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-black text-draw-ink text-sm">搭乘 JX801 航班 ✈️</h3>
                                <span class="font-black text-white bg-draw-blue border-2 border-draw-ink px-2.5 py-1 rounded-lg text-xs shadow-draw-sm">13:45 起飛</span>
                            </div>
                            <p class="text-xs font-bold text-draw-ink">成田機場 (NRT) T2 出發返回台灣。</p>
                        </div>
                    </div>
                    
                    <div class="relative pl-6">
                        <div class="absolute -left-[14px] top-1 w-6 h-6 bg-draw-pink border-[3px] border-draw-ink rounded-full"></div>
                        <div class="bg-[#FFE5EC] border-[3px] border-draw-ink rounded-2xl p-4 shadow-draw">
                            <div class="flex justify-between items-start">
                                <h3 class="font-black text-draw-pink text-sm">抵台專車接送 🏡</h3>
                                <span class="font-black text-draw-ink bg-white border-2 border-draw-ink px-2.5 py-1 rounded-lg text-xs shadow-draw-sm">16:50</span>
                            </div>
                            <p class="text-xs font-bold text-draw-ink mt-2">平安抵達溫暖的家，旅途圓滿結束！</p>
                        </div>
                    </div>
                </div>
            </div>
            
        </section>

        <!-- ==================== TAB 2: GUIDE (深度導覽) ==================== -->
        <section id="tab-guide" class="hidden p-5 space-y-7 fade-in w-full">
            
            <div class="flex items-center mb-4 bg-draw-yellow border-[3px] border-draw-ink px-5 py-2.5 rounded-2xl w-max shadow-draw mt-2">
                <span class="text-base font-black text-draw-ink"><i class="fa-solid fa-book-open mr-2"></i>生存指南手冊 🦖</span>
            </div>

            <!-- 原宿/表參道/銀座 逛街指南 -->
            <article class="bg-white border-[3px] border-draw-ink rounded-3xl overflow-hidden shadow-draw w-full">
                <div class="bg-[#E8F6FA] p-4 border-b-[3px] border-draw-ink flex items-center">
                    <div class="w-10 h-10 bg-white border-[3px] border-draw-ink rounded-full flex items-center justify-center mr-3 shadow-draw-sm"><i class="fa-solid fa-bag-shopping text-draw-blue text-lg"></i></div>
                    <h2 class="font-black text-draw-ink text-base tracking-wide">品牌朝聖指南</h2>
                </div>
                <div class="p-5">
                    <p class="text-xs font-bold text-draw-muted leading-relaxed mb-5 border-b-2 border-dashed border-gray-300 pb-4">
                        建議將目標拆分為「原宿/表參道（潮牌與街區旗艦店）」與「銀座（奢華精品與百貨）」。
                    </p>
                    <ul class="text-xs font-bold text-draw-ink space-y-4">
                        <li class="flex items-start bg-draw-bg p-3.5 border-[3px] border-draw-ink rounded-xl shadow-draw-sm"><i class="fa-solid fa-gem text-draw-pink mt-0.5 mr-2.5 w-4 text-center text-sm"></i><div><strong class="text-draw-pink text-sm mb-1 block">CHANEL</strong>表參道店款式齊全、建築如藝術品；銀座店則擁有最高規格服務。</div></li>
                        <li class="flex items-start bg-draw-bg p-3.5 border-[3px] border-draw-ink rounded-xl shadow-draw-sm"><i class="fa-solid fa-crown text-draw-yellow mt-0.5 mr-2.5 w-4 text-center text-sm"></i><div><strong class="text-draw-yellow text-sm mb-1 block">Vivienne Westwood</strong>青山店為獨立旗艦店風格前衛；銀座隱身於 GINZA SIX 內。</div></li>
                        <li class="flex items-start bg-draw-bg p-3.5 border-[3px] border-draw-ink rounded-xl shadow-draw-sm"><i class="fa-solid fa-heart text-draw-green mt-0.5 mr-2.5 w-4 text-center text-sm"></i><div><strong class="text-draw-green text-sm mb-1 block">HUMAN MADE</strong>原宿店必朝聖；銀座推薦前往 Dover Street Market 挖寶。</div></li>
                        <li class="flex items-start bg-draw-bg p-3.5 border-[3px] border-draw-ink rounded-xl shadow-draw-sm"><i class="fa-solid fa-clock text-draw-blue mt-0.5 mr-2.5 w-4 text-center text-sm"></i><div><strong class="text-draw-blue text-sm mb-1 block">Rolex</strong>日本採不定期進貨，熱門款建議多跑幾間分店。</div></li>
                    </ul>
                </div>
            </article>

            <!-- 迪士尼指南 -->
            <article class="bg-white border-[3px] border-draw-ink rounded-3xl overflow-hidden shadow-draw w-full">
                <div class="bg-[#FFE5EC] p-4 border-b-[3px] border-draw-ink flex items-center">
                    <div class="w-10 h-10 bg-white border-[3px] border-draw-ink rounded-full flex items-center justify-center mr-3 shadow-draw-sm"><i class="fa-solid fa-wand-magic-sparkles text-draw-pink text-lg"></i></div>
                    <div>
                        <h2 class="font-black text-draw-ink text-base tracking-wide leading-tight">迪士尼戰術板</h2>
                        <span class="text-[10px] font-bold text-white bg-draw-pink px-2 py-0.5 rounded-md border-2 border-draw-ink mt-1 inline-block">Happy Entry 特權</span>
                    </div>
                </div>
                <div class="p-5">
                    <p class="text-xs font-bold text-draw-muted leading-relaxed mb-4">
                        入住玩具總動員飯店的最大優勢為「提早15分鐘入園」，請務必善用黃金時間！
                    </p>
                    <div class="bg-draw-bg border-[3px] border-draw-ink rounded-2xl p-4 mb-5 shadow-draw-sm">
                        <strong class="text-draw-ink text-sm block mb-3 font-black"><i class="fa-solid fa-bolt text-draw-yellow mr-1.5 text-lg"></i> 入園SOP：</strong>
                        <ol class="list-decimal pl-5 text-xs space-y-2.5 font-bold text-draw-ink">
                            <li>馬上開啟官方 APP。</li>
                            <li>抽取熱門設施的 Standby Pass。</li>
                            <li>刷卡買 DPA 節省 <span class="text-white bg-draw-pink px-1.5 py-0.5 rounded border border-draw-ink">美女與野獸</span> 排隊時間。</li>
                            <li>晚上提早找絕佳視角看遊行與煙火。</li>
                        </ol>
                    </div>
                    <div>
                        <strong class="text-draw-ink text-sm block mb-3 font-black bg-draw-yellow inline-block px-2">必玩設施 MUST-RIDE</strong>
                        <ul class="text-xs font-bold text-draw-ink space-y-2.5 mt-2">
                            <li class="flex items-center"><span class="w-2 h-2 bg-draw-pink border border-draw-ink rounded-full mr-2.5"></span> <strong class="text-draw-ink mr-2">美女與野獸</strong> <span class="text-[10px] text-draw-muted">(強烈建議DPA)</span></li>
                            <li class="flex items-center"><span class="w-2 h-2 bg-draw-blue border border-draw-ink rounded-full mr-2.5"></span> <strong class="text-draw-ink mr-2">飛濺山</strong> <span class="text-[10px] text-draw-muted">(獨木舟)</span></li>
                            <li class="flex items-center"><span class="w-2 h-2 bg-draw-ink border border-draw-ink rounded-full mr-2.5"></span> <strong class="text-draw-ink mr-2">巨雷山</strong> <span class="text-[10px] text-draw-muted">(礦車)</span></li>
                        </ul>
                    </div>
                </div>
            </article>

            <!-- 自駕指南 -->
            <article class="bg-white border-[3px] border-draw-ink rounded-3xl overflow-hidden shadow-draw w-full">
                <div class="bg-[#E6F7EB] p-4 border-b-[3px] border-draw-ink flex items-center">
                    <div class="w-10 h-10 bg-white border-[3px] border-draw-ink rounded-full flex items-center justify-center mr-3 shadow-draw-sm"><i class="fa-solid fa-car text-draw-green text-lg"></i></div>
                    <h2 class="font-black text-draw-ink text-base tracking-wide">河口湖自駕須知</h2>
                </div>
                <div class="p-5">
                    <div class="bg-white border-[3px] border-draw-ink rounded-2xl p-4 mb-5 shadow-draw relative overflow-hidden">
                        <div class="absolute -right-2 -bottom-2 text-5xl opacity-20">🗻</div>
                        <strong class="text-draw-ink text-sm block mb-3 font-black"><i class="fa-solid fa-camera text-draw-green mr-1.5"></i> 推薦景點：</strong>
                        <ul class="list-disc pl-5 space-y-2.5 text-xs font-bold text-draw-muted relative z-10">
                            <li><strong class="text-draw-ink">大石公園：</strong> 欣賞河口湖與富士山全景。</li>
                            <li><strong class="text-draw-ink">新倉山淺間公園：</strong> 經典五重塔與富士山。</li>
                            <li><strong class="text-draw-ink">天上山纜車：</strong> 登高一覽河口湖全貌。</li>
                            <li><strong class="text-draw-ink">餺飥麵 (不動)：</strong> 東戀路店為可愛雲朵建築。</li>
                        </ul>
                    </div>

                    <ul class="text-xs font-bold text-draw-ink space-y-3 mb-5">
                        <li class="flex items-start"><i class="fa-solid fa-check mt-0.5 mr-2.5 text-draw-pink"></i><strong>必備：</strong>護照、台灣駕照正本、日文譯本。</li>
                        <li class="flex items-start"><i class="fa-solid fa-check mt-0.5 mr-2.5 text-draw-pink"></i><strong>ETC卡：</strong>建議租借，走藍色專用道，還車結算。</li>
                        <li class="flex items-start"><i class="fa-solid fa-check mt-0.5 mr-2.5 text-draw-pink"></i><strong>加油：</strong>還車前須加滿油 (Regular/紅槍)，保留收據。</li>
                    </ul>
                    <div class="bg-[#FFE5EC] border-[3px] border-draw-pink text-draw-ink p-3 rounded-xl text-[11px] font-black leading-relaxed shadow-sm">
                        <i class="fa-solid fa-triangle-exclamation mr-1.5 text-draw-pink text-sm"></i> 日本為右駕靠左。若發生擦撞務必報警(110)拿事故證明，否則保險不理賠！
                    </div>
                </div>
            </article>

            <!-- teamLab 指南 -->
            <article class="bg-white border-[3px] border-draw-ink rounded-3xl overflow-hidden shadow-draw w-full">
                <div class="bg-draw-yellow p-4 border-b-[3px] border-draw-ink flex items-center">
                    <div class="w-10 h-10 bg-white border-[3px] border-draw-ink rounded-full flex items-center justify-center mr-3 shadow-draw-sm"><i class="fa-solid fa-lightbulb text-draw-ink text-lg"></i></div>
                    <h2 class="font-black text-draw-ink text-base tracking-wide">teamLab Planets</h2>
                </div>
                <div class="p-5 text-center">
                    <p class="text-xs font-bold text-draw-muted leading-relaxed text-justify mb-5">
                        主打「身臨其境」的五感體驗。館內部分區域需要涉水（水深約至成人小腿），強烈建議穿著容易捲起褲管的服裝。
                    </p>
                    <a href="https://lovetogo.tw/202501-tokyo/teamlab-planets/index.php" target="_blank" class="inline-block bg-draw-ink text-white text-sm font-black rounded-xl px-6 py-3.5 border-[3px] border-draw-ink shadow-draw draw-btn w-full">
                        查看圖文導覽文章 <i class="fa-solid fa-arrow-up-right-from-square ml-1.5"></i>
                    </a>
                </div>
            </article>

        </section>

        <!-- ==================== TAB 3: WALLET (記帳) ==================== -->
        <section id="tab-wallet" class="hidden p-5 fade-in w-full">
            
            <div class="bg-draw-green border-[3px] border-draw-ink rounded-3xl p-5 shadow-draw mb-8 flex justify-between items-center w-full">
                <div>
                    <h3 class="text-xs font-black text-draw-ink bg-white border-[3px] border-draw-ink px-2.5 py-1 rounded-lg inline-block mb-2.5 shadow-draw-sm">匯率計算機</h3>
                    <p class="text-3xl font-black text-white drop-shadow-md">1 JPY = <span id="display-rate" class="text-draw-yellow">0.215</span> <span class="text-sm">TWD</span></p>
                </div>
                <button onclick="changeRate()" class="bg-white border-[3px] border-draw-ink text-draw-ink text-sm font-black rounded-xl px-3 py-2.5 shadow-draw draw-btn"><i class="fa-solid fa-pen mr-1 text-draw-pink"></i>修改</button>
            </div>

            <!-- 新增記帳表單 -->
            <div class="bg-white border-[3px] border-draw-ink rounded-3xl p-5 shadow-draw mb-8 w-full">
                <h3 class="text-lg font-black text-draw-ink mb-4 border-b-[3px] border-dashed border-gray-300 pb-3"><i class="fa-solid fa-piggy-bank text-draw-yellow mr-2 text-2xl"></i>記帳撲滿</h3>
                <div class="space-y-4">
                    <input type="text" id="expense-name" placeholder="買了什麼？ (例: 恐龍扭蛋)" class="w-full bg-draw-bg border-[3px] border-draw-ink rounded-xl p-4 text-sm font-bold focus:bg-white outline-none text-draw-ink transition-colors shadow-inner">
                    
                    <div class="relative w-full">
                        <input type="text" id="expense-math" placeholder="日幣金額 (可輸入 500+200*3)" class="w-full bg-draw-bg border-[3px] border-draw-ink rounded-xl p-4 text-sm font-bold focus:bg-white outline-none text-draw-ink pr-12 transition-colors shadow-inner">
                        <span class="absolute right-5 top-4 text-draw-pink text-base font-black">¥</span>
                    </div>
                    
                    <!-- 拍照/上傳按鈕 -->
                    <div class="w-full">
                        <input type="file" id="expense-photo" accept="image/*" capture="environment" class="hidden" onchange="previewPhoto(event)">
                        <label for="expense-photo" class="flex items-center justify-center w-full border-[3px] border-dashed border-draw-blue bg-[#E8F6FA] rounded-xl p-4 cursor-pointer hover:bg-blue-100 transition-colors text-draw-blue text-sm font-black">
                            <i class="fa-solid fa-camera mr-2 text-xl"></i> 上傳收據或戰利品照
                        </label>
                        <div id="photo-preview-container" class="hidden mt-4 relative inline-block">
                            <img id="photo-preview" class="h-24 w-24 object-cover border-[3px] border-draw-ink rounded-xl shadow-draw">
                            <button onclick="removePhoto()" class="absolute -top-3 -right-3 bg-draw-pink text-white border-[3px] border-draw-ink rounded-full w-8 h-8 flex items-center justify-center text-sm shadow-draw draw-btn"><i class="fa-solid fa-times"></i></button>
                        </div>
                    </div>
                    
                    <button onclick="addExpense()" class="w-full bg-draw-yellow text-draw-ink border-[3px] border-draw-ink font-black rounded-xl p-4 text-base shadow-draw draw-btn mt-2 tracking-wide">
                        存入撲滿！ 🪙
                    </button>
                </div>
            </div>

            <!-- 記帳列表 -->
            <div class="w-full">
                <div class="flex justify-between items-end mb-4 border-b-[4px] border-draw-ink pb-2 px-1">
                    <h3 class="text-lg font-black text-draw-ink">花費紀錄</h3>
                    <div class="text-right">
                        <p class="text-[10px] font-bold text-draw-muted">總計 (TWD)</p>
                        <p class="text-2xl font-black text-draw-pink" id="total-twd">NT$ 0</p>
                    </div>
                </div>
                <div id="expense-list" class="space-y-4 pb-4">
                    <!-- 動態產生 -->
                </div>
            </div>
        </section>

        <!-- ==================== TAB 4: LISTS (清單) ==================== -->
        <section id="tab-lists" class="hidden p-5 space-y-8 fade-in w-full">
            
            <!-- 願望景點許願池 -->
            <div class="w-full">
                <div class="flex items-center mb-4 bg-white border-[3px] border-draw-ink px-4 py-2.5 rounded-2xl w-max shadow-draw mt-2">
                    <span class="text-base font-black text-draw-ink"><i class="fa-solid fa-star text-draw-yellow mr-2"></i>願望許願池 ✨</span>
                </div>
                <div class="bg-white border-[3px] border-draw-ink rounded-3xl p-5 shadow-draw mb-5 w-full">
                    <div class="space-y-4">
                        <input type="text" id="wish-name" placeholder="想去哪裡？ (例: 晴空塔)" class="w-full bg-draw-bg border-[3px] border-draw-ink rounded-xl p-4 text-sm font-bold focus:bg-white outline-none shadow-inner">
                        <input type="text" id="wish-note" placeholder="網址或備註..." class="w-full bg-draw-bg border-[3px] border-draw-ink rounded-xl p-4 text-sm font-bold focus:bg-white outline-none shadow-inner">
                        
                        <!-- 照片上傳 -->
                        <div class="w-full">
                            <input type="file" id="wish-photo" accept="image/*" class="hidden" onchange="previewWishPhoto(event)">
                            <label for="wish-photo" class="flex items-center justify-center w-full border-[3px] border-dashed border-draw-green bg-[#E6F7EB] rounded-xl p-4 cursor-pointer hover:bg-green-100 transition-colors text-draw-green text-sm font-black">
                                <i class="fa-solid fa-image mr-2 text-xl"></i> 附上參考圖片
                            </label>
                            <div id="wish-photo-preview-container" class="hidden mt-4 relative inline-block">
                                <img id="wish-photo-preview" class="h-24 w-24 object-cover border-[3px] border-draw-ink rounded-xl shadow-draw">
                                <button onclick="removeWishPhoto()" class="absolute -top-3 -right-3 bg-draw-pink text-white border-[3px] border-draw-ink rounded-full w-8 h-8 flex items-center justify-center text-sm shadow-draw draw-btn"><i class="fa-solid fa-times"></i></button>
                            </div>
                        </div>

                        <button onclick="addWish()" class="w-full bg-draw-ink text-white font-black rounded-xl p-4 text-base border-[3px] border-draw-ink shadow-draw draw-btn mt-2">
                            加進清單！ 🦕
                        </button>
                    </div>
                </div>
                
                <!-- 願望清單列表 -->
                <div id="wish-list" class="space-y-4 w-full">
                    <!-- 動態產生 -->
                </div>
            </div>

            <!-- Checklist -->
            <div class="w-full">
                <div class="flex justify-between items-center mb-4 w-full">
                    <div class="flex items-center bg-white border-[3px] border-draw-ink px-4 py-2.5 rounded-2xl shadow-draw">
                        <span class="text-base font-black text-draw-ink"><i class="fa-solid fa-clipboard-check text-draw-green mr-2"></i>行前準備 🎒</span>
                    </div>
                    <button onclick="resetChecklist()" class="text-xs font-black text-white bg-draw-ink border-[3px] border-draw-ink px-4 py-2.5 rounded-xl shadow-draw-sm draw-btn">重設</button>
                </div>
                <div class="bg-white border-[3px] border-draw-ink rounded-3xl shadow-draw overflow-hidden w-full" id="checklist-container">
                    <!-- 動態產生 -->
                </div>
            </div>

            <!-- 備忘錄 -->
            <div class="w-full">
                <div class="flex items-center mb-4 bg-white border-[3px] border-draw-ink px-4 py-2.5 rounded-2xl w-max shadow-draw">
                    <span class="text-base font-black text-draw-ink"><i class="fa-solid fa-pen-clip text-draw-blue mr-2"></i>隨手筆記 📝</span>
                </div>
                <div class="bg-white border-[3px] border-draw-ink rounded-3xl p-5 shadow-draw w-full">
                    <textarea id="memo-input" rows="5" placeholder="記錄代購清單、MapCode..." class="w-full bg-draw-bg rounded-xl border-[3px] border-draw-ink p-4 font-bold focus:bg-white outline-none text-sm text-draw-ink leading-relaxed resize-none shadow-inner"></textarea>
                    <div class="flex justify-end pt-4 mt-1">
                        <button onclick="saveMemo()" class="text-sm font-black text-draw-ink bg-draw-yellow border-[3px] border-draw-ink px-6 py-3 rounded-xl shadow-draw draw-btn">儲存筆記</button>
                    </div>
                </div>
                <div id="memo-display" class="mt-5 bg-white border-[3px] border-dashed border-draw-ink rounded-3xl p-5 text-sm font-bold text-draw-ink leading-relaxed hidden whitespace-pre-wrap break-words shadow-draw w-full"></div>
            </div>
        </section>

        <!-- ==================== TAB 5: INFO (資訊) ==================== -->
        <section id="tab-info" class="hidden p-5 space-y-7 fade-in w-full">
            
            <div class="bg-white border-[3px] border-draw-ink rounded-3xl p-5 shadow-draw mt-2 w-full">
                <h3 class="text-lg font-black text-draw-ink mb-4 border-b-[3px] border-dashed border-gray-300 pb-3"><i class="fa-solid fa-link mr-2 text-draw-blue"></i>實用小幫手</h3>
                <div class="grid grid-cols-2 gap-4">
                    <a href="https://tenki.jp/forecast/3/16/4410/13108/" target="_blank" class="flex flex-col items-center justify-center p-5 bg-[#E8F6FA] border-[3px] border-draw-ink rounded-2xl shadow-draw draw-btn transition-all">
                        <i class="fa-solid fa-cloud-sun text-4xl text-draw-blue mb-3"></i>
                        <span class="text-sm font-black text-draw-ink">東京天氣</span>
                    </a>
                    <a href="https://vjw-lp.digital.go.jp/zh-hant/" target="_blank" class="flex flex-col items-center justify-center p-5 bg-[#FFE5EC] border-[3px] border-draw-ink rounded-2xl shadow-draw draw-btn transition-all">
                        <i class="fa-solid fa-qrcode text-4xl text-draw-pink mb-3"></i>
                        <span class="text-sm font-black text-draw-ink">V.J.W.</span>
                    </a>
                </div>
            </div>

            <div class="bg-draw-ink text-white border-[3px] border-draw-ink rounded-3xl p-5 shadow-draw w-full">
                <h3 class="text-lg font-black text-draw-yellow mb-4 border-b-2 border-gray-600 pb-3"><i class="fa-solid fa-phone mr-2"></i>求救專線 🚨</h3>
                <ul class="space-y-5 font-bold text-sm tracking-wide">
                    <li class="flex justify-between items-center">
                        <span class="text-gray-300">警察局 (報案/車禍)</span>
                        <a href="tel:110" class="text-draw-ink font-black bg-white border-[3px] border-draw-ink px-4 py-1.5 rounded-xl shadow-draw-sm draw-btn">110</a>
                    </li>
                    <li class="flex justify-between items-center">
                        <span class="text-gray-300">消防・救護車</span>
                        <a href="tel:119" class="text-white font-black bg-draw-pink border-[3px] border-draw-ink px-4 py-1.5 rounded-xl shadow-draw-sm draw-btn">119</a>
                    </li>
                    <li class="flex justify-between items-center">
                        <span class="text-gray-300">台北駐日代表處</span>
                        <a href="tel:0332807811" class="text-draw-ink font-black bg-white border-[3px] border-draw-ink px-4 py-1.5 rounded-xl shadow-draw-sm draw-btn text-xs">03-3280-7811</a>
                    </li>
                </ul>
            </div>

            <div class="bg-[#FFE5EC] border-[3px] border-draw-pink rounded-3xl p-5 shadow-draw relative w-full">
                <h3 class="text-lg font-black text-draw-pink mb-4"><i class="fa-solid fa-circle-exclamation mr-2"></i>千萬要注意！</h3>
                <ul class="text-xs text-draw-ink font-bold space-y-4 leading-relaxed">
                    <li class="flex items-start"><i class="fa-solid fa-ban text-draw-pink mt-0.5 mr-2 text-base"></i><strong class="text-draw-pink text-sm bg-white px-1 border border-draw-pink rounded">嚴禁攜帶肉類製品</strong>（含肉乾、泡麵肉塊等）返回台灣，違者高額罰款。</li>
                    <li class="flex items-start"><i class="fa-solid fa-volume-xmark text-draw-blue mt-0.5 mr-2 text-base"></i>日本電車內禁止通話，請將手機設為靜音。</li>
                    <li class="flex items-start"><i class="fa-solid fa-stairs text-draw-green mt-0.5 mr-2 text-base"></i>電扶梯習慣：東京地區通常靠左站立。</li>
                    <li class="flex items-start"><i class="fa-solid fa-bottle-droplet text-draw-yellow mt-0.5 mr-2 text-base"></i>隨身行李液體：單一容器不超過 100ml，需裝入透明夾鏈袋。</li>
                </ul>
            </div>
            
        </section>

    </main>

    <!-- Bottom Navigation (無上方黑線) -->
    <nav class="bg-draw-bg absolute bottom-0 w-full z-30 pb-safe shadow-[0_-4px_20px_rgba(0,0,0,0.05)] border-t border-gray-200">
        <div class="flex justify-around items-center px-2 py-2">
            <button onclick="switchTab('plan')" id="nav-plan" class="nav-btn flex flex-col items-center w-14 transition-colors text-draw-ink">
                <div class="bg-white border-[3px] border-draw-ink p-2.5 rounded-2xl mb-1 shadow-draw"><i class="fa-solid fa-map-location-dot text-2xl text-draw-pink"></i></div>
                <span class="text-[11px] font-black">行程</span>
            </button>
            <button onclick="switchTab('guide')" id="nav-guide" class="nav-btn flex flex-col items-center w-14 transition-colors text-draw-muted">
                <div class="bg-transparent border-[3px] border-transparent p-2.5 rounded-2xl mb-1"><i class="fa-solid fa-book-open text-2xl"></i></div>
                <span class="text-[11px] font-bold">導覽</span>
            </button>
            <button onclick="switchTab('wallet')" id="nav-wallet" class="nav-btn flex flex-col items-center w-14 transition-colors text-draw-muted">
                <div class="bg-transparent border-[3px] border-transparent p-2.5 rounded-2xl mb-1"><i class="fa-solid fa-wallet text-2xl"></i></div>
                <span class="text-[11px] font-bold">記帳</span>
            </button>
            <button onclick="switchTab('lists')" id="nav-lists" class="nav-btn flex flex-col items-center w-14 transition-colors text-draw-muted">
                <div class="bg-transparent border-[3px] border-transparent p-2.5 rounded-2xl mb-1"><i class="fa-solid fa-clipboard-check text-2xl"></i></div>
                <span class="text-[11px] font-bold">清單</span>
            </button>
            <button onclick="switchTab('info')" id="nav-info" class="nav-btn flex flex-col items-center w-14 transition-colors text-draw-muted">
                <div class="bg-transparent border-[3px] border-transparent p-2.5 rounded-2xl mb-1"><i class="fa-solid fa-circle-info text-2xl"></i></div>
                <span class="text-[11px] font-bold">資訊</span>
            </button>
        </div>
    </nav>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white border-[4px] border-draw-ink text-draw-ink text-lg font-black px-8 py-4 rounded-3xl shadow-draw transition-opacity duration-300 opacity-0 pointer-events-none z-50 flex items-center">
        <i class="fa-solid fa-check-circle mr-3 text-draw-green text-2xl"></i> <span id="toast-msg">已儲存 🦕</span>
    </div>

    <!-- JavaScript -->
    <script>
        /* ================= Core ================= */
        const TABS = ['plan', 'guide', 'wallet', 'lists', 'info'];
        let currentPhotoBase64 = null;
        let exchangeRate = parseFloat(localStorage.getItem('cartoon_trip_rate')) || 0.215;
        let expenses = JSON.parse(localStorage.getItem('cartoon_trip_expenses')) || [];
        
        let wishPhotoBase64 = null;
        let wishes = JSON.parse(localStorage.getItem('cartoon_trip_wishlist')) || [];

        // 對應 Bottom Nav 的顏色設定
        const navColors = {
            'plan': { iconColor: 'text-draw-pink' },
            'guide': { iconColor: 'text-draw-yellow' },
            'wallet': { iconColor: 'text-draw-green' },
            'lists': { iconColor: 'text-draw-blue' },
            'info': { iconColor: 'text-draw-ink' }
        };

        window.onload = () => {
            initLists();
            initWallet();
            initMemo();
            initWishlist(); 
        };

        function switchTab(tabId) {
            TABS.forEach(t => {
                document.getElementById(`tab-${t}`).classList.add('hidden');
                
                let navBtn = document.getElementById(`nav-${t}`);
                navBtn.classList.remove('text-draw-ink');
                navBtn.classList.add('text-draw-muted');
                navBtn.querySelector('span').classList.remove('font-black');
                navBtn.querySelector('span').classList.add('font-bold');
                
                let iconDiv = navBtn.querySelector('div');
                iconDiv.classList.remove('bg-white', 'border-draw-ink', 'shadow-draw');
                iconDiv.classList.add('bg-transparent', 'border-transparent');
                
                let icon = iconDiv.querySelector('i');
                icon.className = icon.className.replace(/text-draw-\w+/, ''); 
            });
            
            document.getElementById(`tab-${tabId}`).classList.remove('hidden');
            
            let targetNavBtn = document.getElementById(`nav-${tabId}`);
            targetNavBtn.classList.remove('text-draw-muted');
            targetNavBtn.classList.add('text-draw-ink');
            targetNavBtn.querySelector('span').classList.remove('font-bold');
            targetNavBtn.querySelector('span').classList.add('font-black');
            
            let targetIconDiv = targetNavBtn.querySelector('div');
            targetIconDiv.classList.remove('bg-transparent', 'border-transparent');
            targetIconDiv.classList.add('bg-white', 'border-draw-ink', 'shadow-draw');
            
            let targetIcon = targetIconDiv.querySelector('i');
            targetIcon.classList.add(navColors[tabId].iconColor);
            
            document.getElementById('main-content').scrollTop = 0;
        }
        
        /* ================= PLAN Day Tabs ================= */
        function switchPlanDay(dayNum) {
            for(let i=1; i<=6; i++) {
                let el = document.getElementById(`plan-d${i}`);
                if(el) el.classList.add('hidden');
                
                let btn = document.getElementById(`btn-d${i}`);
                if(btn) {
                    btn.classList.remove('bg-draw-yellow', 'text-draw-ink', 'shadow-draw-pressed', 'translate-y-[4px]');
                    btn.classList.add('bg-white', 'text-draw-ink', 'shadow-draw');
                }
            }
            
            let targetEl = document.getElementById(`plan-d${dayNum}`);
            if(targetEl) targetEl.classList.remove('hidden');
            
            let targetBtn = document.getElementById(`btn-d${dayNum}`);
            if(targetBtn) {
                targetBtn.classList.remove('bg-white', 'text-draw-ink', 'shadow-draw');
                targetBtn.classList.add('bg-draw-yellow', 'text-draw-ink', 'shadow-draw-pressed', 'translate-y-[4px]');
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = message;
            toast.classList.remove('opacity-0');
            setTimeout(() => { toast.classList.add('opacity-0'); }, 1500);
        }

        /* ================= WALLET ================= */
        function initWallet() {
            document.getElementById('display-rate').innerText = exchangeRate;
            renderExpenses();
        }

        function changeRate() {
            const newRate = prompt("請輸入匯率 (1日幣 = ?台幣)", exchangeRate);
            if (newRate && !isNaN(newRate)) {
                exchangeRate = parseFloat(newRate);
                localStorage.setItem('cartoon_trip_rate', exchangeRate);
                document.getElementById('display-rate').innerText = exchangeRate;
                renderExpenses();
                showToast("匯率更新啦！");
            }
        }

        function previewPhoto(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const MAX_WIDTH = 300;
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > MAX_WIDTH) {
                        height *= MAX_WIDTH / width;
                        width = MAX_WIDTH;
                    }
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    currentPhotoBase64 = canvas.toDataURL('image/jpeg', 0.6);
                    document.getElementById('photo-preview').src = currentPhotoBase64;
                    document.getElementById('photo-preview-container').classList.remove('hidden');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function removePhoto() {
            currentPhotoBase64 = null;
            document.getElementById('expense-photo').value = "";
            document.getElementById('photo-preview-container').classList.add('hidden');
        }

        function addExpense() {
            const name = document.getElementById('expense-name').value.trim();
            const mathStr = document.getElementById('expense-math').value.trim();
            
            if (!name || !mathStr) {
                alert("請填寫品項與金額喔！");
                return;
            }

            let jpyAmount = 0;
            try {
                const safeMath = mathStr.replace(/[^0-9+\-*/().]/g, '');
                if(safeMath === "") throw new Error("Empty math");
                jpyAmount = Math.round(new Function(`return (${safeMath})`)());
            } catch (e) {
                alert("算式格式錯誤，請輸入數字或簡單算式~");
                return;
            }

            const newExp = {
                id: Date.now(),
                name: name,
                jpy: jpyAmount,
                photo: currentPhotoBase64,
                date: new Date().toLocaleDateString('zh-TW', {month: 'numeric', day: 'numeric', hour: '2-digit', minute:'2-digit'})
            };

            expenses.unshift(newExp);
            localStorage.setItem('cartoon_trip_expenses', JSON.stringify(expenses));
            
            document.getElementById('expense-name').value = "";
            document.getElementById('expense-math').value = "";
            removePhoto();
            renderExpenses();
            showToast("金幣存入撲滿！💰");
        }

        function deleteExpense(id) {
            if(confirm("確定要刪除這筆紀錄嗎？")) {
                expenses = expenses.filter(e => e.id !== id);
                localStorage.setItem('cartoon_trip_expenses', JSON.stringify(expenses));
                renderExpenses();
            }
        }

        function renderExpenses() {
            const container = document.getElementById('expense-list');
            container.innerHTML = "";
            let totalTWD = 0;

            if(expenses.length === 0) {
                container.innerHTML = '<p class="text-center text-sm font-bold text-draw-muted py-8 bg-white border-[3px] border-dashed border-gray-300 rounded-3xl w-full">撲滿空空的，還沒有花錢喔！</p>';
            }

            expenses.forEach(exp => {
                const twd = Math.round(exp.jpy * exchangeRate);
                totalTWD += twd;

                const photoHTML = exp.photo ? 
                    `<img src="${exp.photo}" class="w-16 h-16 object-cover rounded-xl border-[3px] border-draw-ink cursor-pointer shadow-draw-sm" onclick="window.open('${exp.photo}')">` : 
                    `<div class="w-16 h-16 bg-draw-bg rounded-xl flex items-center justify-center text-draw-ink/30 border-[3px] border-dashed border-draw-ink/30"><i class="fa-solid fa-receipt text-2xl"></i></div>`;

                const html = `
                <div class="bg-white p-4 rounded-3xl border-[3px] border-draw-ink shadow-draw flex items-center gap-4 fade-in w-full">
                    ${photoHTML}
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-start">
                            <h4 class="text-base font-black text-draw-ink truncate">${exp.name}</h4>
                            <button onclick="deleteExpense(${exp.id})" class="text-draw-muted hover:text-draw-pink px-2 draw-btn"><i class="fa-solid fa-trash text-sm"></i></button>
                        </div>
                        <div class="flex justify-between items-end mt-2">
                            <p class="text-[11px] font-bold text-draw-muted">${exp.date}</p>
                            <div class="text-right">
                                <p class="text-xs font-black text-draw-muted">¥ ${exp.jpy.toLocaleString()}</p>
                                <p class="text-lg font-black text-draw-pink">NT$ ${twd.toLocaleString()}</p>
                            </div>
                        </div>
                    </div>
                </div>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });
            document.getElementById('total-twd').innerText = `NT$ ${totalTWD.toLocaleString()}`;
        }

        /* ================= WISHLIST ================= */
        function initWishlist() {
            renderWishes();
        }

        function previewWishPhoto(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const MAX_WIDTH = 300;
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > MAX_WIDTH) {
                        height *= MAX_WIDTH / width;
                        width = MAX_WIDTH;
                    }
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    wishPhotoBase64 = canvas.toDataURL('image/jpeg', 0.6);
                    document.getElementById('wish-photo-preview').src = wishPhotoBase64;
                    document.getElementById('wish-photo-preview-container').classList.remove('hidden');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function removeWishPhoto() {
            wishPhotoBase64 = null;
            document.getElementById('wish-photo').value = "";
            document.getElementById('wish-photo-preview-container').classList.add('hidden');
        }

        function addWish() {
            const name = document.getElementById('wish-name').value.trim();
            const note = document.getElementById('wish-note').value.trim();
            
            if (!name) {
                alert("請填寫想去哪裡唷！");
                return;
            }

            const newWish = {
                id: Date.now(),
                name: name,
                note: note,
                photo: wishPhotoBase64,
                date: new Date().toLocaleDateString('zh-TW', {month: 'numeric', day: 'numeric'})
            };

            wishes.unshift(newWish);
            localStorage.setItem('cartoon_trip_wishlist', JSON.stringify(wishes));
            
            document.getElementById('wish-name').value = "";
            document.getElementById('wish-note').value = "";
            removeWishPhoto();
            renderWishes();
            showToast("願望加一！ ✨");
        }

        function deleteWish(id) {
            if(confirm("確定要刪除這個願望嗎？")) {
                wishes = wishes.filter(w => w.id !== id);
                localStorage.setItem('cartoon_trip_wishlist', JSON.stringify(wishes));
                renderWishes();
            }
        }

        function renderWishes() {
            const container = document.getElementById('wish-list');
            container.innerHTML = "";

            if(wishes.length === 0) {
                container.innerHTML = '<p class="text-center text-sm font-bold text-draw-muted py-6">許願池空空的，快加點什麼吧！</p>';
                return;
            }

            wishes.forEach((wish) => {
                let displayNote = "";
                if(wish.note) {
                    const escapedNote = wish.note.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                    const urlRegex = /(https?:\/\/[^\s]+)/g;
                    displayNote = escapedNote.replace(urlRegex, function(url) {
                        return `<a href="${url}" target="_blank" class="text-draw-blue font-black underline decoration-2 hover:text-draw-pink"><i class="fa-solid fa-link text-[10px] mr-1"></i>看連結</a>`;
                    });
                }

                const photoHTML = wish.photo ? 
                    `<img src="${wish.photo}" class="w-16 h-16 object-cover rounded-xl border-[3px] border-draw-ink cursor-pointer mr-3 shadow-draw-sm" onclick="window.open('${wish.photo}')">` : 
                    ``;

                const html = `
                <div class="bg-white p-4 rounded-3xl border-[3px] border-draw-ink shadow-draw flex items-start fade-in w-full">
                    ${photoHTML}
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-start">
                            <h4 class="text-base font-black text-draw-ink break-words pr-2">${wish.name}</h4>
                            <button onclick="deleteWish(${wish.id})" class="text-draw-muted hover:text-draw-pink p-1 shrink-0 draw-btn"><i class="fa-solid fa-trash text-sm"></i></button>
                        </div>
                        ${displayNote ? `<p class="text-xs font-bold text-draw-ink mt-2 break-words bg-draw-bg border-2 border-dashed border-draw-ink/30 p-2.5 rounded-xl">${displayNote}</p>` : ''}
                        <p class="text-[10px] font-black text-draw-muted mt-3 text-right">${wish.date} 許願</p>
                    </div>
                </div>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        /* ================= LISTS ================= */
        const defaultChecklist = [
            "護照 (效期需滿6個月) 🛂",
            "駕照正本與日文譯本 (自駕必備) 🚗",
            "日幣現金與信用卡 (JCB佳) 💳",
            "網卡 / eSIM 📱",
            "迪士尼門票 / 飯店訂單 🏰",
            "行動電源與充電線 🔋",
            "個人常備藥品 💊",
            "好穿的運動鞋 👟",
            "輕便雨具 ☔"
        ];

        function initLists() {
            const savedData = JSON.parse(localStorage.getItem('cartoon_trip_checklist')) || {};
            const container = document.getElementById('checklist-container');
            container.innerHTML = "";

            defaultChecklist.forEach((item, index) => {
                const isChecked = savedData[index] ? 'checked' : '';
                const lineThrough = savedData[index] ? 'line-through text-draw-muted' : 'text-draw-ink';
                
                const html = `
                <label class="flex items-center p-4 border-b-[3px] border-draw-ink/10 last:border-0 cursor-pointer hover:bg-gray-50 transition-colors w-full">
                    <input type="checkbox" onchange="toggleCheck(${index}, this)" ${isChecked} class="w-6 h-6 text-draw-green border-[3px] border-draw-ink rounded focus:ring-draw-green focus:ring-2 accent-draw-green">
                    <span id="check-text-${index}" class="ml-4 text-sm font-bold ${lineThrough} transition-all duration-200">${item}</span>
                </label>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        function toggleCheck(index, element) {
            const savedData = JSON.parse(localStorage.getItem('cartoon_trip_checklist')) || {};
            savedData[index] = element.checked;
            localStorage.setItem('cartoon_trip_checklist', JSON.stringify(savedData));
            
            const textSpan = document.getElementById(`check-text-${index}`);
            if(element.checked) {
                textSpan.classList.add('line-through', 'text-draw-muted');
                textSpan.classList.remove('text-draw-ink');
            } else {
                textSpan.classList.remove('line-through', 'text-draw-muted');
                textSpan.classList.add('text-draw-ink');
            }
        }

        function resetChecklist() {
            if(confirm("確定要清除所有打勾狀態嗎？")) {
                localStorage.removeItem('cartoon_trip_checklist');
                initLists();
            }
        }

        /* ================= MEMO ================= */
        function initMemo() {
            const savedMemo = localStorage.getItem('cartoon_trip_memo') || "";
            document.getElementById('memo-input').value = savedMemo;
            renderMemoDisplay(savedMemo);
        }

        function saveMemo() {
            const text = document.getElementById('memo-input').value;
            localStorage.setItem('cartoon_trip_memo', text);
            renderMemoDisplay(text);
            showToast("筆記已儲存 📝");
        }

        function renderMemoDisplay(text) {
            const displayDiv = document.getElementById('memo-display');
            if(text.trim() === "") {
                displayDiv.classList.add('hidden');
                return;
            }
            displayDiv.classList.remove('hidden');
            
            let escapedText = text.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            const linkedText = escapedText.replace(urlRegex, function(url) {
                return `<a href="${url}" target="_blank" class="text-draw-blue underline decoration-[3px] hover:text-draw-pink font-black"><i class="fa-solid fa-arrow-up-right-from-square mr-1 text-[10px]"></i>傳送門</a>`;
            });
            
            displayDiv.innerHTML = linkedText;
        }

    </script>
</body>
</html>
