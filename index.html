<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Tokyo 2026 ğŸ–ï¸ | æ±äº¬å¤§å†’éšª</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@500;700;800;900&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['"M PLUS Rounded 1c"', 'sans-serif'] },
          colors: { draw: { bg: '#FDFCF8', ink: '#2B2D42', yellow: '#FFD166', pink: '#EF476F', blue: '#118AB2', green: '#06D6A0', muted: '#6C757D' } },
          boxShadow: { 'cartoon': '3px 3px 0px 0px #2B2D42', 'cartoon-sm': '2px 2px 0px 0px #2B2D42', 'nav': '0 -4px 20px rgba(0, 0, 0, 0.05)' }
        }
      }
    }
  </script>
  <style>
    body { background-color: #FDFCF8; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: none; }
    /* è³ªæ„Ÿé»é™£èƒŒæ™¯ */
    body::before { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: radial-gradient(#E2E2E2 1.5px, transparent 1.5px); background-size: 24px 24px; z-index: -1; pointer-events: none; }
    
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    
    .fade-in { animation: fadeIn 0.3s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    
    .click-effect { transition: transform 0.1s, box-shadow 0.1s; }
    .click-effect:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0px 0px #2B2D42 !important; }
    
    .img-prop { width: 100%; border-radius: 12px; border: 2px solid #2B2D42; cursor: zoom-in; object-fit: contain; }
    
    details > summary { list-style: none; }
    details > summary::-webkit-details-marker { display: none; }
    
    /* é¿å…åº•éƒ¨å°è¦½åˆ—é®æ“‹å…§å®¹ (é ç•™é«˜åº¦) */
    .pb-safe { padding-bottom: calc(90px + env(safe-area-inset-bottom)); }
    
    /* ç„¡é»‘ç·šåº•éƒ¨å°è¦½åˆ—æ¼¸å±¤èåˆæ•ˆæœ */
    .nav-gradient { background: linear-gradient(to top, #FDFCF8 85%, rgba(253,252,248,0.9) 95%, transparent); }
  </style>
</head>
<body class="text-draw-ink font-sans h-screen flex flex-col m-0 p-0 overflow-hidden">

  <header class="pt-12 pb-3 px-5 flex justify-between items-end shrink-0 z-20 relative">
    <div>
      <h1 class="text-3xl font-black tracking-wide">Tokyo 2026</h1>
      <p class="text-[11px] font-bold text-draw-pink mt-1 bg-white border-2 border-draw-ink shadow-cartoon-sm inline-block px-3 py-1 rounded-full">æ±äº¬å¤§å†’éšª ğŸ‡¯ğŸ‡µ</p>
    </div>
    <div class="bg-draw-yellow text-draw-ink border-2 border-draw-ink shadow-cartoon-sm px-3 py-1.5 rounded-xl font-black flex items-center">
      <i class="fa-solid fa-calendar-day mr-2"></i><span class="text-xs">3/12 - 3/17</span>
    </div>
  </header>

  <main class="flex-1 overflow-y-auto no-scrollbar pb-safe relative z-10 w-full px-4" id="main-content">
      
    <section id="tab-plan" class="fade-in space-y-5 mt-2">
      
      <div class="flex overflow-x-auto no-scrollbar space-x-2 py-2 sticky top-0 z-30 -mx-4 px-4 pb-3" style="background: linear-gradient(to bottom, #FDFCF8 80%, transparent);">
        <button onclick="showDay(1)" id="btn-d1" class="day-btn bg-draw-pink text-white border-2 border-draw-ink shadow-cartoon-sm shrink-0 w-16 py-2 rounded-xl font-black text-sm transition-all">D1</button>
        <button onclick="showDay(2)" id="btn-d2" class="day-btn bg-white text-draw-ink border-2 border-draw-ink shadow-cartoon-sm shrink-0 w-16 py-2 rounded-xl font-black text-sm transition-all">D2</button>
        <button onclick="showDay(3)" id="btn-d3" class="day-btn bg-white text-draw-ink border-2 border-draw-ink shadow-cartoon-sm shrink-0 w-16 py-2 rounded-xl font-black text-sm transition-all">D3</button>
        <button onclick="showDay(4)" id="btn-d4" class="day-btn bg-white text-draw-ink border-2 border-draw-ink shadow-cartoon-sm shrink-0 w-16 py-2 rounded-xl font-black text-sm transition-all">D4</button>
        <button onclick="showDay(5)" id="btn-d5" class="day-btn bg-white text-draw-ink border-2 border-draw-ink shadow-cartoon-sm shrink-0 w-16 py-2 rounded-xl font-black text-sm transition-all">D5</button>
        <button onclick="showDay(6)" id="btn-d6" class="day-btn bg-white text-draw-ink border-2 border-draw-ink shadow-cartoon-sm shrink-0 w-16 py-2 rounded-xl font-black text-sm transition-all">D6</button>
      </div>

      <div id="day-1" class="day-content fade-in space-y-4">
        <div class="bg-white border-2 border-draw-ink shadow-cartoon rounded-2xl p-4">
          <h3 class="font-black text-draw-blue border-b-2 border-dashed border-gray-300 pb-2 mb-3"><i class="fa-solid fa-plane text-xl mr-2"></i> å‡ºç™¼ & è¿ªå£«å°¼</h3>
          <ul class="space-y-4 text-xs font-bold relative border-l-2 border-draw-ink ml-2 pl-4">
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-draw-pink border-2 border-draw-ink rounded-full"></div>
              <span class="bg-draw-yellow px-2 py-0.5 rounded border-2 border-draw-ink mr-2 text-black">03:30</span> æ©Ÿå ´æ¥é€
            </li>
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-white border-2 border-draw-ink rounded-full"></div>
              <span class="text-draw-pink">06:40 èµ·é£›</span> TR898 (TPE â” NRT)
            </li>
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-white border-2 border-draw-ink rounded-full"></div>
              åˆ©æœ¨æ´¥å·´å£«ç›´é”é£¯åº—é–€å£
              <button onclick="openImg('https://biglocal.github.io/tokyo2026/%E6%88%AA%E5%9C%96%202026-02-22%20%E6%99%9A%E4%B8%8A8.03.44.png?raw=true')" class="mt-2 bg-draw-blue text-white px-3 py-1.5 rounded-lg border-2 border-draw-ink shadow-cartoon-sm click-effect block w-max"><i class="fa-solid fa-bus mr-1"></i> å·´å£«æ™‚åˆ»è¡¨</button>
            </li>
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-white border-2 border-draw-ink rounded-full"></div>
              <strong class="text-sm block mb-1">ä¼Šå…‹æ–¯çš®å…’è‰ (Ikspiari) åˆé¤</strong>
              éå¸¸å¤§å‹çš„æ­é¢¨å•†å ´ï¼Œå…­å€‹äººåœ¨é€™è£¡æ‰¾é–“å¯¬æ•çš„é¤å»³è§£æ±ºåˆé¤æœ€ç‚ºèˆ’é©ã€‚
              <div class="mt-2 inline-block bg-black text-white px-2 py-1 rounded border-2 border-draw-ink shadow-sm text-[10px]"><i class="fa-solid fa-bowl-food mr-1"></i>é™„è¿‘æœ‰ä¸€è˜­æ‹‰éºµ</div>
            </li>
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-draw-green border-2 border-draw-ink rounded-full"></div>
              <span class="bg-draw-green text-white px-2 py-0.5 rounded border-2 border-draw-ink mr-2">15:00</span> Check-in è¿ªå£«å°¼é£¯åº—
            </li>
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-white border-2 border-draw-ink rounded-full"></div>
              è¦–é«”åŠ›è³¼è²·å‚æ™šç¥¨é€²è¿ªå£«å°¼æ¨‚åœ’ï¼Œçœ‹å¤œé–“éŠè¡Œèˆ‡ç…™ç« ğŸ†
              <div class="bg-gray-100 p-3 rounded-xl border-2 border-draw-ink shadow-sm mt-2 text-[10px] leading-relaxed">
                <strong class="text-draw-pink block mb-1">è¿ªå£«å°¼å‚æ™šç¥¨åƒ¹ï¼š</strong>
                å¹³æ—¥ 17:00èµ·ï¼šÂ¥4,500 - Â¥6,200<br>
                å‡æ—¥ 15:00èµ·ï¼šÂ¥6,500 - Â¥8,700
              </div>
            </li>
          </ul>
        </div>
      </div>

      <div id="day-2" class="day-content hidden fade-in space-y-4">
        <div class="bg-white border-2 border-draw-ink shadow-cartoon rounded-2xl p-4">
          <h3 class="font-black text-draw-pink border-b-2 border-dashed border-gray-300 pb-2 mb-3"><i class="fa-solid fa-wand-magic-sparkles text-xl mr-2"></i> Disney Land å…¨æ—¥</h3>
          <ul class="space-y-5 text-xs font-bold relative border-l-2 border-draw-ink ml-2 pl-4">
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-draw-pink border-2 border-draw-ink rounded-full"></div>
              <span class="bg-draw-pink text-white px-2 py-0.5 rounded border-2 border-draw-ink mr-2">08:00 å‰</span> æŠµé”é–€å£ (Happy Entry 08:30-08:45æ”¾äºº)
            </li>
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-white border-2 border-draw-ink rounded-full"></div>
              <button onclick="openImg('https://biglocal.github.io/tokyo2026/%E6%88%AA%E5%9C%96%202026-02-22%20%E4%B8%8B%E5%8D%883.23.20.png')" class="w-full bg-draw-yellow text-draw-ink px-3 py-2.5 rounded-xl border-2 border-draw-ink shadow-cartoon-sm click-effect mb-1 text-center"><i class="fa-solid fa-map mr-1"></i> é»æ“ŠæŸ¥çœ‹å…¥åœ’åœ°åœ–</button>
            </li>
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-white border-2 border-draw-ink rounded-full"></div>
              <strong class="text-draw-pink text-sm block mb-2">ğŸ¯ å¿…ç©é‡é»è¨­æ–½ï¼š</strong>
              <div class="flex flex-wrap gap-2">
                <span class="border-2 border-draw-ink px-2.5 py-1 rounded bg-white shadow-sm">ğŸŒ¹ ç¾å¥³èˆ‡é‡ç¸</span>
                <span class="border-2 border-draw-ink px-2.5 py-1 rounded bg-white shadow-sm">ğŸ’¦ é£›æ¿ºå±±</span>
                <span class="border-2 border-draw-ink px-2.5 py-1 rounded bg-white shadow-sm">ğŸš‚ å·¨é›·å±±</span>
              </div>
            </li>
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-white border-2 border-draw-ink rounded-full"></div>
              <button onclick="openImg('https://biglocal.github.io/tokyo2026/%E6%88%AA%E5%9C%96%202026-02-22%20%E4%B8%8B%E5%8D%883.23.32.png')" class="w-full bg-draw-blue text-white px-3 py-2.5 rounded-xl border-2 border-draw-ink shadow-cartoon-sm click-effect text-center"><i class="fa-solid fa-route mr-1"></i> æŸ¥çœ‹éŠè¡Œè·¯ç·š</button>
            </li>
          </ul>
        </div>
      </div>

      <div id="day-3" class="day-content hidden fade-in space-y-4">
        <div class="bg-draw-yellow border-2 border-draw-ink shadow-cartoon rounded-2xl p-4 text-center">
            <h3 class="font-black text-draw-ink text-sm mb-3"><i class="fa-solid fa-map-location-dot mr-1"></i> åŸå®¿ / è¡¨åƒé“ æ•£æ­¥åœ°åœ–</h3>
            <div class="bg-white rounded-xl border-2 border-draw-ink h-48 relative overflow-hidden text-[10px] font-black shadow-inner">
                <div class="absolute top-[45%] w-full border-t-4 border-dashed border-gray-300"></div>
                <div class="absolute left-[35%] h-full border-l-4 border-dashed border-gray-300"></div>
                <span class="absolute top-[36%] right-2 text-gray-400">è¡¨åƒé“</span>
                <span class="absolute bottom-2 left-[38%] text-gray-400">æ˜æ²»é€š/è²“è¡—</span>
                
                <div class="absolute top-2 left-2">
                    <span class="bg-black text-white px-2 py-1 rounded border-2 border-draw-ink shadow-sm">ä¸€è˜­æ‹‰éºµ</span>
                </div>
                <div class="absolute top-4 right-4">
                    <span class="bg-green-500 text-white px-2 py-1 rounded border-2 border-draw-ink shadow-sm">Human Made</span>
                </div>
                <div class="absolute bottom-4 left-2">
                    <span class="bg-pink-500 text-white px-2 py-1 rounded border-2 border-draw-ink shadow-sm">Chanel</span>
                </div>
                <div class="absolute bottom-4 right-4">
                    <span class="bg-yellow-400 text-black px-2 py-1 rounded border-2 border-draw-ink shadow-sm">Vivienne W.</span>
                </div>
                <div class="absolute top-[45%] left-[60%] transform -translate-x-1/2 -translate-y-1/2 mt-3">
                    <span class="bg-blue-500 text-white px-2 py-1 rounded border-2 border-draw-ink shadow-sm">Rolex</span>
                </div>
            </div>
        </div>

        <div class="bg-white border-2 border-draw-ink shadow-cartoon rounded-2xl p-4">
          <ul class="space-y-6 text-xs font-bold relative border-l-2 border-draw-ink ml-2 pl-4">
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-draw-pink border-2 border-draw-ink rounded-full"></div>
              <span class="bg-draw-yellow px-2 py-0.5 rounded border-2 border-draw-ink mr-2 text-black">08:30 å‡ºç™¼</span> è±ªå¾·å¯º ğŸˆ
              <img src="https://biglocal.github.io/tokyo2026/day3_cat.png" onclick="openImg(this.src)" class="img-prop mt-3 h-28 object-cover" onerror="this.style.display='none'">
              <a href="https://tokyo.letsgojp.com/archives/762222/" target="_blank" class="inline-block mt-2 text-draw-blue bg-blue-50 px-2 py-1 rounded border-2 border-blue-200 click-effect"><i class="fa-solid fa-link"></i> è±ªå¾·å¯ºæ”»ç•¥</a>
            </li>
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-white border-2 border-draw-ink rounded-full"></div>
              <strong class="text-sm block mb-1.5">åŸå®¿ â” é’å±± / è¡¨åƒé“</strong>
              <span class="text-[10px] text-white bg-draw-blue px-2 py-1 rounded border-2 border-draw-ink shadow-cartoon-sm inline-block"><i class="fa-solid fa-train mr-1"></i> äº¤é€šç´„ 30 åˆ†é˜</span>
              <p class="mt-2 text-draw-pink"><i class="fa-solid fa-utensils"></i> ç¾é£Ÿï¼šLUKE'S LOBSTER è¡¨åƒé“è²“è¡—åº—</p>
            </li>
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-white border-2 border-draw-ink rounded-full"></div>
              <strong class="block text-sm">å”æ©‹æ¡Œçƒ (ä»£ä»£æœ¨)</strong>
              <span class="text-draw-muted block mt-1">ç‡Ÿæ¥­æ™‚é–“ï¼š10:00 - 19:00</span>
            </li>
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-white border-2 border-draw-ink rounded-full"></div>
              <strong class="block text-sm">æ¾€è°· & SHIBUYA SKY å¤œæ™¯ ğŸŒƒ</strong>
            </li>
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-draw-ink border-2 border-draw-ink rounded-full"></div>
              å›æ°‘å®¿å‰è¦å» TOYOTA å¾å¦»æ©‹åº—å–è»Š ğŸš™
            </li>
          </ul>
        </div>
      </div>

      <div id="day-4" class="day-content hidden fade-in space-y-4">
        <div class="bg-white border-2 border-draw-ink shadow-cartoon rounded-2xl p-2 h-64 overflow-hidden">
            <iframe width="100%" height="100%" frameborder="0" src="https://www.google.com/maps/embed?pb=!1m28!1m12!1m3!1d828690.697523924!2d138.6473187285141!3d35.63155823795329!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!4m13!3e0!4m5!1s0x60188ed836ca149b%3A0xc3312e541b6ec26f!2z5pel5pys44CSMTMwLTAwMDIgVG9reW8sIFN1bWlkYSBDaXR5LCBOYXJpaGlyYSwgM-S4geebruKIkjfjiJI1!3m2!1d35.709322!2d139.8143242!4m5!1s0x60195e3474fc32e1%3A0xbd85f675bc0cbb57!2z5rKz5Y-j5rmW!3m2!1d35.5170954!2d138.7517855!5e0!3m2!1szh-TW!2stw!4v1700000000000" class="rounded-xl border-2 border-draw-ink pointer-events-none"></iframe>
        </div>
        <div class="bg-white border-2 border-draw-ink shadow-cartoon rounded-2xl p-4">
          <ul class="space-y-5 text-xs font-bold relative border-l-2 border-draw-ink ml-2 pl-4">
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-draw-green border-2 border-draw-ink rounded-full"></div>
              <span class="bg-draw-green text-white px-2 py-0.5 rounded border-2 border-draw-ink mr-2">06:30</span> é©…è»Šå‰å¾€æ²³å£æ¹– ğŸ—»
            </li>
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-white border-2 border-draw-ink rounded-full"></div>
              <strong class="text-sm block mb-1">æ™šé¤ï¼šAFURI æ‹‰éºµ ğŸœ</strong>
              å—ç”ºç”° Grandberry Parkåº—
            </li>
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-draw-ink border-2 border-draw-ink rounded-full"></div>
              çµæŸå¾Œé‚„è»Š (å¾å¦»æ©‹) ğŸš—
            </li>
          </ul>
        </div>
      </div>

      <div id="day-5" class="day-content hidden fade-in space-y-4">
        <div class="bg-white border-2 border-draw-ink shadow-cartoon rounded-2xl p-5 flex justify-between items-center text-center font-black text-[11px]">
            <div><i class="fa-solid fa-torii-gate text-draw-pink text-3xl mb-2"></i><br>æ·ºè‰å¯º</div>
            <i class="fa-solid fa-arrow-right text-gray-300"></i>
            <div><i class="fa-solid fa-gamepad text-draw-blue text-3xl mb-2"></i><br>ç§‹è‘‰åŸ</div>
            <i class="fa-solid fa-arrow-right text-gray-300"></i>
            <div><i class="fa-solid fa-train text-draw-green text-3xl mb-2"></i><br>æ±äº¬ç«™</div>
            <i class="fa-solid fa-arrow-right text-gray-300"></i>
            <div><i class="fa-solid fa-gem text-draw-yellow text-3xl mb-2"></i><br>éŠ€åº§</div>
        </div>
        <div class="bg-white border-2 border-draw-ink shadow-cartoon rounded-2xl p-4 text-xs font-bold leading-relaxed">
            <p class="bg-blue-50 px-3 py-2 rounded-xl border-2 border-blue-200 inline-block mb-3 shadow-sm"><i class="fa-solid fa-train-subway text-draw-blue mr-1"></i> å„é»äº¤é€šæ™‚é–“å¤§ç´„æŠ“ 15~20 åˆ†é˜ã€‚</p>
            <div class="bg-gray-50 p-4 rounded-xl border-2 border-dashed border-gray-300">
                <strong class="text-draw-pink block mb-2 text-sm"><i class="fa-solid fa-map-pin"></i> å‘¨é‚Šååº—æ¨™è¨˜ (éŠ€åº§)ï¼š</strong>
                <div class="flex flex-wrap gap-2">
                    <span class="inline-block bg-pink-200 px-2 py-1 rounded border border-black shadow-sm">Chanel</span>
                    <span class="inline-block bg-yellow-200 px-2 py-1 rounded border border-black shadow-sm">Vivienne Westwood</span>
                    <span class="inline-block bg-green-200 px-2 py-1 rounded border border-black shadow-sm">Human Made</span>
                    <span class="inline-block bg-blue-200 px-2 py-1 rounded border border-black shadow-sm">Rolex</span>
                </div>
            </div>
        </div>
      </div>

      <div id="day-6" class="day-content hidden fade-in space-y-4">
        <div class="bg-white border-2 border-draw-ink shadow-cartoon rounded-2xl p-4">
          <ul class="space-y-6 text-xs font-bold relative border-l-2 border-draw-ink ml-2 pl-4">
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-white border-2 border-draw-ink rounded-full"></div>
              <span class="bg-draw-yellow px-2 py-0.5 rounded border-2 border-draw-ink mr-2 text-black">09:00</span> èµ·åºŠæ•´ç†ï¼Œæ©Ÿå ´æ¥é€è‡³æˆç”°æ©Ÿå ´
            </li>
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-white border-2 border-draw-ink rounded-full"></div>
              <span class="text-white bg-draw-pink px-2 py-0.5 rounded border-2 border-draw-ink shadow-cartoon-sm inline-block mb-1">13:45 èµ·é£›</span><br> JX801 (NRT T2 â” TPE)
            </li>
            <li class="relative"><div class="absolute -left-[23px] top-0.5 w-3 h-3 bg-draw-ink border-2 border-draw-ink rounded-full"></div>
              <span class="bg-draw-ink text-white px-2 py-0.5 rounded border-2 border-draw-ink mr-2">16:50</span> æŠµé”å°ç£ï¼Œæ­ä¹˜å°ˆè»Šå¹³å®‰è¿”å®¶ ğŸ¡
            </li>
          </ul>
        </div>
      </div>
    </section>

    <section id="tab-guide" class="hidden fade-in space-y-4">
      <h2 class="font-black text-xl mb-3"><i class="fa-solid fa-book-open text-draw-yellow mr-2"></i> æ·±åº¦å°è¦½</h2>
      
      <details class="bg-white border-2 border-draw-ink shadow-cartoon rounded-2xl group outline-none overflow-hidden">
        <summary class="font-black p-4 border-b-2 border-transparent group-open:border-draw-ink cursor-pointer flex justify-between items-center bg-pink-50 transition-colors">
          <span>ğŸ›ï¸ é€›è¡—æˆ°è¡“åˆ†æ</span><i class="fa-solid fa-chevron-down transition-transform group-open:rotate-180"></i>
        </summary>
        <div class="p-4 text-xs font-bold space-y-3 bg-white leading-relaxed">
          <p><span class="bg-pink-200 px-2 py-0.5 rounded border border-black text-black inline-block w-full mb-1">Chanel</span> éŠ€åº§æ——è‰¦åº—è²¨æºè¼ƒè¶³ï¼Œè¡¨åƒé“åº—å»ºç¯‰å¾ˆç¾å€¼å¾—ä¸€çœ‹ã€‚</p>
          <p><span class="bg-yellow-200 px-2 py-0.5 rounded border border-black text-black inline-block w-full mb-1">Vivienne Westwood</span> é’å±±æ——è‰¦åº—æ¬¾å¼ç¨ç‰¹ï¼›éŠ€åº§åº—éš±èº«æ–¼ GINZA SIX å…§ã€‚</p>
          <p><span class="bg-green-200 px-2 py-0.5 rounded border border-black text-black inline-block w-full mb-1">Human Made</span> åŸå®¿åº—ç‚ºæ½®æµè–åœ°ï¼Œå¸¸é ˆæ’éšŠï¼›éŠ€åº§å¯å‰å¾€ Dover Street Market (DSM)ã€‚</p>
          <p><span class="bg-blue-200 px-2 py-0.5 rounded border border-black text-black inline-block w-full mb-1">Rolex</span> æ¡ä¸å®šæœŸé€²è²¨ï¼Œç†±é–€é‹å‹•æ¬¾å…¨çœ‹é‹æ°£ï¼Œå»ºè­°ç¶“éå°±é€²å»å•ã€‚</p>
          <p><span class="bg-gray-200 px-2 py-0.5 rounded border border-black text-black inline-block w-full mb-1">ä¸€è˜­æ‹‰éºµ</span> åŸå®¿åº—ä½æ–¼ç¥å®®å‰ï¼Œé€›ç´¯äº†éš¨æ™‚è£œå……é«”åŠ›ã€‚</p>
        </div>
      </details>

      <details class="bg-white border-2 border-draw-ink shadow-cartoon rounded-2xl group outline-none overflow-hidden">
        <summary class="font-black p-4 border-b-2 border-transparent group-open:border-draw-ink cursor-pointer flex justify-between items-center bg-blue-50 transition-colors">
          <span>ğŸ—» æ²³å£æ¹– æ¨è–¦æ™¯é»</span><i class="fa-solid fa-chevron-down transition-transform group-open:rotate-180"></i>
        </summary>
        <div class="p-4 text-xs font-bold space-y-3 bg-white">
          <li class="list-none flex items-start"><i class="fa-solid fa-location-dot text-draw-pink mt-1 mr-2"></i><div><strong class="text-draw-blue">æ–°å€‰å±±æ·ºé–“å…¬åœ’ï¼š</strong>ç¶“å…¸çš„äº”é‡å¡”èˆ‡å¯Œå£«å±±åŒæ¡†çµ•æ™¯ï¼Œéœ€çˆ¬ä¸€æ®µéšæ¢¯ã€‚</div></li>
          <li class="list-none flex items-start"><i class="fa-solid fa-location-dot text-draw-pink mt-1 mr-2"></i><div><strong class="text-draw-blue">å¤§çŸ³å…¬åœ’ï¼š</strong>ä½æ–¼æ¹–ç•”ï¼Œæœ‰å¹³å¦çš„æ­¥é“èˆ‡å››å­£èŠ±å‰ã€‚</div></li>
          <li class="list-none flex items-start"><i class="fa-solid fa-location-dot text-draw-pink mt-1 mr-2"></i><div><strong class="text-draw-blue">ä¸‹å‰ç”°å•†åº—è¡—ï¼š</strong>çŸ¥åç¶²ç´…æ‹ç…§è·¯å£ï¼Œæ‹ç…§æ™‚<strong class="text-red-500">å‹™å¿…æ³¨æ„ä¾†è»Šï¼Œéµå®ˆäº¤é€šè¦å‰‡</strong>ã€‚</div></li>
        </div>
      </details>

      <details class="bg-white border-2 border-draw-ink shadow-cartoon rounded-2xl group outline-none overflow-hidden">
        <summary class="font-black p-4 border-b-2 border-transparent group-open:border-draw-ink cursor-pointer flex justify-between items-center bg-yellow-50 transition-colors">
          <span>âœ¨ teamLab Planets æ”»ç•¥</span><i class="fa-solid fa-chevron-down transition-transform group-open:rotate-180"></i>
        </summary>
        <div class="p-4 text-xs font-bold space-y-3 bg-white text-center">
          <p class="text-left bg-gray-50 p-3 rounded-xl border border-gray-200">ä¸»æ‰“ã€Œèº«è‡¨å…¶å¢ƒã€çš„äº”æ„Ÿé«”é©—ã€‚é¤¨å…§éƒ¨åˆ†å€åŸŸéœ€è¦æ¶‰æ°´ï¼ˆæ°´æ·±ç´„è‡³å°è…¿ï¼‰ï¼Œå¼·çƒˆå»ºè­°ç©¿è‘—çŸ­è¤²æˆ–å®¹æ˜“æ²èµ·è¤²ç®¡çš„æœè£ã€‚ç¾å ´å¯å…è²»å€Ÿç”¨æ‰‹æ©Ÿé˜²æ°´è¢‹ã€‚</p>
          <a href="https://lovetogo.tw/202501-tokyo/teamlab-planets/index.php" target="_blank" class="inline-block bg-draw-blue text-white px-5 py-3 rounded-xl border-2 border-draw-ink shadow-cartoon-sm click-effect mt-2 w-full"><i class="fa-solid fa-link"></i> æŸ¥çœ‹è©³ç´°åœ–æ–‡å°è¦½</a>
        </div>
      </details>

      <div class="bg-white border-2 border-draw-ink shadow-cartoon rounded-2xl p-3 mt-4">
        <p class="font-black text-sm mb-2 ml-1"><i class="fa-solid fa-map text-draw-green mr-1"></i> è¿ªå£«å°¼åœ’å€å‘¨é‚Šåœ°åœ–</p>
        <div class="rounded-xl border-2 border-draw-ink overflow-hidden h-56">
          <iframe width="100%" height="100%" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://www.openstreetmap.org/export/embed.html?bbox=139.8732%2C35.6263%2C139.8892%2C35.6373&layer=mapnik"></iframe>
        </div>
      </div>
    </section>

    <section id="tab-wallet" class="hidden fade-in space-y-5">
      <div class="bg-draw-green text-draw-ink border-2 border-draw-ink shadow-cartoon rounded-2xl p-5 flex justify-between items-center relative overflow-hidden">
        <i class="fa-solid fa-yen-sign absolute -right-4 -bottom-4 text-6xl text-white opacity-30"></i>
        <div class="relative z-10">
          <p class="text-[10px] font-black mb-1 bg-white px-2 py-0.5 rounded inline-block border-2 border-draw-ink">è¨­å®šåŒ¯ç‡</p>
          <div class="flex items-center gap-2 mt-1">
            <span class="font-black text-sm text-white">1 JPY =</span>
            <input type="number" id="rate-input" value="0.21" step="0.001" class="w-20 px-2 py-1.5 rounded-lg border-2 border-draw-ink font-black text-sm outline-none text-center">
            <span class="font-black text-sm text-white">TWD</span>
          </div>
        </div>
        <div class="text-right relative z-10">
          <p class="text-[10px] font-black bg-black text-white px-2 py-0.5 rounded inline-block mb-1 border-2 border-black">å°å¹£ç¸½èŠ±è²»</p>
          <p id="total-twd" class="text-2xl font-black text-white drop-shadow-md">NT$ 0</p>
        </div>
      </div>

      <div class="bg-white border-2 border-draw-ink shadow-cartoon rounded-2xl p-5 space-y-4">
        <h3 class="font-black text-sm border-b-2 border-dashed border-gray-300 pb-2"><i class="fa-solid fa-coins text-draw-yellow mr-1 text-lg"></i> è¨˜ä¸€ç­†èŠ±è²»</h3>
        
        <input type="text" id="exp-name" placeholder="è²·äº†ä»€éº¼ï¼Ÿ (ä¾‹: æé¾æ‰­è›‹)" class="w-full bg-gray-50 border-2 border-draw-ink rounded-xl p-3 text-sm font-bold outline-none focus:bg-white transition-colors">
        
        <div class="relative">
          <input type="text" id="exp-jpy" placeholder="æ—¥å¹£é‡‘é¡ (æ”¯æ´ç®—å¼å¦‚ 500+200*3)" class="w-full bg-gray-50 border-2 border-draw-ink rounded-xl p-3 text-sm font-bold outline-none focus:bg-white transition-colors pr-10">
          <span class="absolute right-4 top-3.5 font-black text-draw-pink text-base">Â¥</span>
        </div>
        
        <div class="flex gap-2 pt-1">
          <input type="file" id="exp-img" accept="image/*" capture="environment" class="hidden" onchange="previewImg(event)">
          <label for="exp-img" class="flex-1 bg-draw-blue text-white text-center rounded-xl p-3.5 border-2 border-draw-ink shadow-cartoon-sm click-effect text-xs font-black cursor-pointer"><i class="fa-solid fa-camera mr-1"></i> æ‹ç…§/ä¸Šå‚³</label>
          <button onclick="addExpense()" class="flex-1 bg-draw-pink text-white text-center rounded-xl p-3.5 border-2 border-draw-ink shadow-cartoon-sm click-effect text-xs font-black"><i class="fa-solid fa-plus mr-1"></i> å­˜å…¥æ’²æ»¿</button>
        </div>
        
        <div id="img-preview-box" class="hidden relative w-20 h-20 border-2 border-draw-ink rounded-xl overflow-hidden mt-2">
          <img id="img-preview" src="" class="w-full h-full object-cover">
          <button onclick="removePreview()" class="absolute top-0 right-0 bg-red-500 text-white w-6 h-6 flex items-center justify-center text-xs border-l-2 border-b-2 border-draw-ink"><i class="fa-solid fa-times"></i></button>
        </div>
      </div>

      <div id="expense-list" class="space-y-3 pb-4">
        </div>
    </section>

    <section id="tab-lists" class="hidden fade-in space-y-5">
      <div class="bg-white border-2 border-draw-ink shadow-cartoon rounded-2xl p-5">
        <h3 class="font-black text-sm mb-3 border-b-2 border-dashed border-gray-300 pb-2"><i class="fa-solid fa-clipboard-check text-draw-green mr-1 text-lg"></i> è¡Œå‰æº–å‚™ CheckList</h3>
        <div id="checklist-box" class="space-y-1 text-sm font-bold mt-3">
          </div>
      </div>

      <div class="bg-white border-2 border-draw-ink shadow-cartoon rounded-2xl p-5">
        <h3 class="font-black text-sm mb-3 border-b-2 border-dashed border-gray-300 pb-2"><i class="fa-solid fa-pen text-draw-pink mr-1 text-lg"></i> å€‹äººå‚™å¿˜éŒ„</h3>
        <textarea id="memo-input" rows="5" class="w-full bg-gray-50 border-2 border-draw-ink rounded-xl p-4 text-sm font-bold outline-none mb-3 focus:bg-white transition-colors" placeholder="åœ¨æ­¤è¼¸å…¥æ–‡å­—ï¼Œè‹¥æ˜¯è²¼ä¸Šç¶²å€æœƒè‡ªå‹•è½‰æ›ç‚ºé»æ“ŠæŒ‰éˆ•å–”..."></textarea>
        <button onclick="saveMemo()" class="w-full bg-draw-yellow text-draw-ink border-2 border-draw-ink shadow-cartoon-sm rounded-xl py-3 font-black text-sm click-effect"><i class="fa-solid fa-save mr-1"></i> å„²å­˜å‚™å¿˜éŒ„</button>
        <div id="memo-display" class="mt-4 text-xs font-bold leading-relaxed hidden bg-gray-50 p-4 border-2 border-dashed border-gray-300 rounded-xl break-words"></div>
      </div>
    </section>

    <section id="tab-info" class="hidden fade-in space-y-5">
      
      <div class="bg-white border-2 border-draw-ink shadow-cartoon rounded-2xl p-5 relative mt-3 mb-5">
        <div class="absolute -top-3 left-4 bg-draw-blue text-white text-[11px] font-black px-4 py-1 border-2 border-draw-ink shadow-sm rounded-lg"><i class="fa-solid fa-bookmark mr-1"></i> é è¨‚å¿«è¨Š</div>
        <div id="info-sheet-content" class="mt-2 space-y-3">
          <div class="text-center text-draw-muted text-xs animate-pulse py-4 font-bold">æ­£åœ¨è¼‰å…¥æ©Ÿç¥¨èˆ‡ä½å®¿è³‡æ–™...</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <a href="https://www.jma.go.jp/jma/index.html" target="_blank" class="bg-white border-2 border-draw-ink shadow-cartoon-sm rounded-2xl p-4 text-center click-effect font-black text-xs flex flex-col items-center justify-center">
            <div class="bg-blue-50 w-12 h-12 rounded-full flex items-center justify-center border-2 border-draw-ink mb-2"><i class="fa-solid fa-cloud-sun text-draw-blue text-xl"></i></div>
            æ—¥æœ¬æ°£è±¡å»³
        </a>
        <a href="https://www.e-japannavi.com/trans/tokyo_images/mtrmap.pdf" target="_blank" class="bg-white border-2 border-draw-ink shadow-cartoon-sm rounded-2xl p-4 text-center click-effect font-black text-xs flex flex-col items-center justify-center">
            <div class="bg-green-50 w-12 h-12 rounded-full flex items-center justify-center border-2 border-draw-ink mb-2"><i class="fa-solid fa-train-subway text-draw-green text-xl"></i></div>
            åœ°éµåœ°åœ– PDF
        </a>
      </div>

      <div class="bg-draw-ink text-white border-2 border-draw-ink shadow-cartoon rounded-2xl p-5 font-black text-xs">
        <h3 class="text-draw-yellow mb-3 border-b-2 border-gray-600 pb-2"><i class="fa-solid fa-phone mr-1"></i> ç·Šæ€¥æ±‚æ•‘å°ˆç·š ğŸš¨</h3>
        <div class="flex justify-between items-center mb-3"><span>è­¦å¯Ÿå±€ (å ±æ¡ˆ)</span> <a href="tel:110" class="bg-white text-draw-ink px-4 py-1.5 rounded-lg border-2 border-white click-effect">110</a></div>
        <div class="flex justify-between items-center mb-3"><span>æ¶ˆé˜²ãƒ»æ•‘è­·è»Š</span> <a href="tel:119" class="bg-draw-pink text-white px-4 py-1.5 rounded-lg border-2 border-draw-pink click-effect">119</a></div>
        <div class="flex justify-between items-center"><span>å°åŒ—é§æ—¥ä»£è¡¨è™•</span> <a href="tel:0332807811" class="bg-white text-draw-ink px-4 py-1.5 rounded-lg border-2 border-white click-effect">03-3280-7811</a></div>
      </div>

      <div class="bg-pink-50 border-2 border-draw-ink shadow-cartoon rounded-2xl p-5 font-bold text-xs text-draw-ink mb-4">
        <h3 class="font-black text-draw-pink mb-3 border-b-2 border-pink-200 pb-2"><i class="fa-solid fa-triangle-exclamation mr-1"></i> æ—…éŠæ³¨æ„äº‹é …</h3>
        <ul class="space-y-3 leading-relaxed">
          <li class="flex items-start"><i class="fa-solid fa-ban text-draw-pink mt-0.5 mr-2"></i> <span class="bg-white border-2 border-draw-ink px-1 rounded text-draw-pink mr-1 font-black shadow-sm">åš´ç¦</span>æ”œå¸¶è‚‰é¡è£½å“(å«è‚‰ä¹¾ã€æ³¡éºµè‚‰å¡Š)å›å°ã€‚</li>
          <li class="flex items-start"><i class="fa-solid fa-volume-xmark text-draw-blue mt-0.5 mr-2"></i> æ—¥æœ¬é›»è»Šå…§ç¦æ­¢é€šè©±ï¼Œè«‹å°‡æ‰‹æ©Ÿè¨­ç‚ºéœéŸ³ã€‚</li>
          <li class="flex items-start"><i class="fa-solid fa-bottle-droplet text-draw-green mt-0.5 mr-2"></i> éš¨èº«è¡Œææ¶²é«”ï¼Œå–®ä¸€å®¹å™¨ä¸å¯è¶…é 100mlã€‚</li>
        </ul>
      </div>

    </section>

  </main>

  <nav class="nav-gradient fixed bottom-0 left-0 w-full z-40 pb-[env(safe-area-inset-bottom)] pt-4 pointer-events-none">
    <div class="flex justify-around items-center py-2 px-2 bg-[#FDFCF8] pointer-events-auto rounded-t-3xl shadow-nav mx-2 border-2 border-draw-ink mb-2">
      <button onclick="switchTab('plan', this)" class="nav-btn text-draw-pink flex flex-col items-center w-[20%] transition-transform active:scale-90 relative">
        <div class="nav-icon-box bg-white border-2 border-draw-ink shadow-cartoon-sm rounded-xl p-2 mb-1 z-10 -mt-5"><i class="fa-solid fa-map-location-dot text-lg"></i></div>
        <span class="text-[10px] font-black">è¡Œç¨‹</span>
      </button>
      <button onclick="switchTab('guide', this)" class="nav-btn text-draw-muted flex flex-col items-center w-[20%] transition-transform active:scale-90 relative">
        <div class="nav-icon-box border-2 border-transparent p-2 mb-1 z-10"><i class="fa-solid fa-book-open text-lg"></i></div>
        <span class="text-[10px] font-bold">å°è¦½</span>
      </button>
      <button onclick="switchTab('wallet', this)" class="nav-btn text-draw-muted flex flex-col items-center w-[20%] transition-transform active:scale-90 relative">
        <div class="nav-icon-box border-2 border-transparent p-2 mb-1 z-10"><i class="fa-solid fa-wallet text-lg"></i></div>
        <span class="text-[10px] font-bold">è¨˜å¸³</span>
      </button>
      <button onclick="switchTab('lists', this)" class="nav-btn text-draw-muted flex flex-col items-center w-[20%] transition-transform active:scale-90 relative">
        <div class="nav-icon-box border-2 border-transparent p-2 mb-1 z-10"><i class="fa-solid fa-clipboard-check text-lg"></i></div>
        <span class="text-[10px] font-bold">æ¸…å–®</span>
      </button>
      <button onclick="switchTab('info', this)" class="nav-btn text-draw-muted flex flex-col items-center w-[20%] transition-transform active:scale-90 relative">
        <div class="nav-icon-box border-2 border-transparent p-2 mb-1 z-10"><i class="fa-solid fa-circle-info text-lg"></i></div>
        <span class="text-[10px] font-bold">è³‡è¨Š</span>
      </button>
    </div>
  </nav>

  <div id="toast" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-draw-ink text-white text-sm font-black px-6 py-4 rounded-2xl shadow-cartoon transition-opacity duration-300 opacity-0 pointer-events-none z-[60] flex items-center">
    <i class="fa-solid fa-check-circle text-draw-green mr-2 text-xl"></i> <span id="toast-msg">å·²å„²å­˜</span>
  </div>

  <div id="lightbox" class="hidden fixed inset-0 z-[70] bg-black/90 flex justify-center items-center p-4 transition-opacity" onclick="closeImg()">
    <img id="lightbox-img" src="" class="max-w-full max-h-full object-contain rounded-2xl border-4 border-white shadow-2xl">
    <button class="absolute top-6 right-6 text-white text-3xl hover:text-draw-pink"><i class="fa-solid fa-times"></i></button>
  </div>

  <script>
    /* ========== Navigation & Tabs Logic ========== */
    const TABS = ['plan', 'guide', 'wallet', 'lists', 'info'];
    const COLORS = ['text-draw-pink', 'text-draw-yellow', 'text-draw-green', 'text-draw-blue', 'text-draw-ink'];

    function switchTab(tabId, el) {
      TABS.forEach(t => document.getElementById(`tab-${t}`).classList.add('hidden'));
      document.getElementById(`tab-${tabId}`).classList.remove('hidden');
      
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.className = btn.className.replace(/text-draw-\w+/g, 'text-draw-muted');
        btn.querySelector('span').classList.replace('font-black', 'font-bold');
        let iconBox = btn.querySelector('.nav-icon-box');
        iconBox.classList.remove('bg-white', 'border-draw-ink', 'shadow-cartoon-sm', '-mt-5');
        iconBox.classList.add('border-transparent');
      });

      el.classList.remove('text-draw-muted');
      el.classList.add(COLORS[TABS.indexOf(tabId)]);
      el.querySelector('span').classList.replace('font-bold', 'font-black');
      let currentIconBox = el.querySelector('.nav-icon-box');
      currentIconBox.classList.remove('border-transparent');
      currentIconBox.classList.add('bg-white', 'border-draw-ink', 'shadow-cartoon-sm', '-mt-5');
      
      window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function showDay(day) {
      for(let i=1; i<=6; i++) {
        document.getElementById(`day-${i}`).classList.add('hidden');
        let btn = document.getElementById(`btn-d${i}`);
        btn.classList.remove('bg-draw-pink', 'bg-draw-yellow', 'text-white');
        btn.classList.add('bg-white', 'text-draw-ink');
      }
      document.getElementById(`day-${day}`).classList.remove('hidden');
      let target = document.getElementById(`btn-d${day}`);
      target.classList.remove('bg-white', 'text-draw-ink');
      target.classList.add(day===1 ? 'bg-draw-pink' : 'bg-draw-yellow', 'text-white');
    }

    /* ========== Image Lightbox & Toast ========== */
    function openImg(src) {
      document.getElementById('lightbox-img').src = src;
      document.getElementById('lightbox').classList.remove('hidden');
    }
    function closeImg() { document.getElementById('lightbox').classList.add('hidden'); }
    function showToast(msg) {
      const toast = document.getElementById('toast');
      document.getElementById('toast-msg').innerText = msg;
      toast.classList.remove('opacity-0');
      setTimeout(() => toast.classList.add('opacity-0'), 1500);
    }

    /* ========== Google Sheet Fetch (INFO Tab) ========== */
    function loadSheet() {
      const url = `https://docs.google.com/spreadsheets/d/16uetEwwxz6h9jG4iwl64O8KVmk7eFTIgQtOZ95R8Hmc/gviz/tq?tqx=out:json&sheet=fly_cat_hotels`;
      fetch(url)
        .then(r => r.text())
        .then(txt => {
          const json = JSON.parse(txt.substring(txt.indexOf('{'), txt.lastIndexOf('}') + 1));
          const rows = json.table.rows;
          let html = '';
          
          rows.forEach((row, i) => {
            // ä¸è·³éç¬¬ä¸€è¡Œï¼Œä¿è­‰æ‰€æœ‰è³‡æ–™éƒ½èƒ½å°å‡º
            if(row.c && row.c[0] && row.c[0].v) {
              const title = String(row.c[0].v).trim();
              
              // è‹¥ç¬¬ä¸€è¡Œæ˜¯æ¨™é¡Œï¼Œå¯ä»¥åˆ©ç”¨ç‰¹å®šå­—ä¸²é˜²å‘†è·³é (è‹¥éœ€è¦)
              if(title === "æ¨™é¡Œ" || title === "é …ç›®åç¨±") return;

              let detailsHtml = '';
              
              for(let j=1; j<row.c.length; j++) {
                  if(row.c[j] && (row.c[j].v || row.c[j].f)) {
                      const val = String(row.c[j].f || row.c[j].v); // .f ä¿ç•™äº† Googleè¡¨å–®å…§çš„æ›è¡Œ
                      if(val.startsWith('http')) {
                          detailsHtml += `<a href="${val}" target="_blank" class="inline-block bg-draw-blue text-white px-4 py-2 rounded-xl border-2 border-draw-ink shadow-cartoon-sm mt-2 text-xs font-black click-effect w-full text-center"><i class="fa-solid fa-link mr-1"></i> é–‹å•Ÿç›¸é—œé€£çµ</a><br>`;
                      } else {
                          detailsHtml += `<p class="mb-2 last:mb-0">${val.replace(/\n/g, '<br>')}</p>`;
                      }
                  }
              }

              if(detailsHtml === '') detailsHtml = '<p class="text-draw-muted text-[10px]">ç„¡è©³ç´°èªªæ˜</p>';

              html += `
                <details class="bg-white border-2 border-draw-ink rounded-2xl mb-3 group outline-none overflow-hidden shadow-cartoon-sm">
                  <summary class="font-black p-4 border-b-2 border-transparent group-open:border-draw-ink cursor-pointer flex justify-between items-center text-draw-ink text-sm transition-colors hover:bg-yellow-50">
                    <span><i class="fa-solid fa-star text-draw-yellow mr-1.5 text-lg"></i> ${title}</span> 
                    <i class="fa-solid fa-chevron-down transition-transform group-open:rotate-180 text-draw-muted"></i>
                  </summary>
                  <div class="p-4 text-xs bg-gray-50 leading-relaxed break-words text-draw-ink border-t-2 border-draw-ink font-bold">
                    ${detailsHtml}
                  </div>
                </details>`;
            }
          });
          
          document.getElementById('info-sheet-content').innerHTML = html || '<div class="text-center text-draw-muted text-xs">ç›®å‰æ²’æœ‰é è¨‚è³‡æ–™å–”ï¼</div>';
        })
        .catch(err => {
          document.getElementById('info-sheet-content').innerHTML = '<div class="text-center text-draw-pink text-xs font-bold border-2 border-draw-pink p-3 rounded-xl bg-pink-50"><i class="fa-solid fa-triangle-exclamation mr-1"></i> è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¢ºèªè©¦ç®—è¡¨å…±ç”¨è¨­å®šå·²é–‹å•Ÿ</div>';
        });
    }

    /* ========== Wallet (è¨˜å¸³èˆ‡åŒ¯ç‡) ========== */
    let rate = parseFloat(localStorage.getItem('tk26_rate_new')) || 0.21;
    let expenses = JSON.parse(localStorage.getItem('tk26_exp_new')) || [];
    let b64 = null;

    document.getElementById('rate-input').addEventListener('change', function() {
        rate = parseFloat(this.value) || 0.21;
        localStorage.setItem('tk26_rate_new', rate);
        renderExp();
        showToast("åŒ¯ç‡å·²è‡ªå‹•å„²å­˜ï¼");
    });

    function previewImg(e) {
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = function(event) {
        const img = new Image();
        img.onload = function() {
          const canvas = document.createElement('canvas');
          let w = img.width, h = img.height;
          if(w > 400) { h *= 400/w; w = 400; }
          canvas.width = w; canvas.height = h;
          canvas.getContext('2d').drawImage(img, 0, 0, w, h);
          b64 = canvas.toDataURL('image/jpeg', 0.6); 
          document.getElementById('img-preview').src = b64;
          document.getElementById('img-preview-box').classList.remove('hidden');
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    }

    function removePreview() {
      b64 = null;
      document.getElementById('exp-img').value = '';
      document.getElementById('img-preview-box').classList.add('hidden');
    }

    function addExpense() {
      const name = document.getElementById('exp-name').value.trim();
      const mathStr = document.getElementById('exp-jpy').value.trim();
      if(!name || !mathStr) return alert("è«‹è¼¸å…¥åç¨±å’Œé‡‘é¡å–”ï¼");
      
      let jpy = 0;
      try { 
        const safeMath = mathStr.replace(/[^0-9+\-*/().]/g, '');
        if(safeMath === "") throw new Error();
        jpy = Math.round(new Function('return ' + safeMath)()); 
      } 
      catch(e) { return alert("é‡‘é¡ç®—å¼æ ¼å¼éŒ¯èª¤~"); }
      
      expenses.unshift({ 
        id: Date.now(), 
        name, 
        jpy, 
        img: b64, 
        date: new Date().toLocaleDateString('zh-TW', {month:'numeric', day:'numeric', hour:'2-digit', minute:'2-digit'}) 
      });
      localStorage.setItem('tk26_exp_new', JSON.stringify(expenses));
      
      document.getElementById('exp-name').value = '';
      document.getElementById('exp-jpy').value = '';
      removePreview();
      renderExp();
      showToast("é‡‘å¹£å­˜å…¥æ’²æ»¿ï¼ğŸ’°");
    }

    function delExp(id) {
      if(confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿ")) {
        expenses = expenses.filter(e => e.id !== id);
        localStorage.setItem('tk26_exp_new', JSON.stringify(expenses));
        renderExp();
      }
    }

    function renderExp() {
      document.getElementById('rate-input').value = rate;
      const list = document.getElementById('expense-list');
      let twdTotal = 0;
      
      if(expenses.length === 0) {
        list.innerHTML = '<div class="text-center text-draw-muted text-xs py-8 border-2 border-dashed border-gray-300 rounded-2xl bg-gray-50 font-bold"><i class="fa-solid fa-piggy-bank text-2xl mb-2 text-gray-300 block"></i>é‚„æ²’æœ‰ä»»ä½•èŠ±è²»ç´€éŒ„å–”ï¼</div>';
      } else {
        list.innerHTML = expenses.map(e => {
          const twd = Math.round(e.jpy * rate);
          twdTotal += twd;
          const imgTag = e.img 
            ? `<img src="${e.img}" onclick="openImg(this.src)" class="w-14 h-14 object-cover border-2 border-draw-ink rounded-lg cursor-zoom-in shrink-0">` 
            : `<div class="w-14 h-14 bg-gray-100 border-2 border-draw-ink rounded-lg flex items-center justify-center text-gray-400 shrink-0"><i class="fa-solid fa-receipt text-xl"></i></div>`;
          
          return `
            <div class="bg-white border-2 border-draw-ink shadow-cartoon-sm rounded-xl p-3.5 flex gap-3 items-center fade-in">
              ${imgTag}
              <div class="flex-1 min-w-0">
                <div class="flex justify-between items-start">
                  <span class="font-black text-sm text-draw-ink truncate pr-2">${e.name}</span> 
                  <button onclick="delExp(${e.id})" class="text-gray-300 hover:text-draw-pink transition-colors"><i class="fa-solid fa-trash text-sm"></i></button>
                </div>
                <div class="flex justify-between items-end mt-1.5">
                  <span class="text-[9px] text-gray-400 font-bold">${e.date}</span>
                  <div class="text-right leading-tight">
                    <span class="block text-[10px] font-black text-draw-muted">Â¥ ${e.jpy.toLocaleString()}</span> 
                    <span class="block text-sm font-black text-draw-pink mt-0.5">NT$ ${twd.toLocaleString()}</span>
                  </div>
                </div>
              </div>
            </div>`;
        }).join('');
      }
      document.getElementById('total-twd').innerText = `NT$ ${twdTotal.toLocaleString()}`;
    }

    /* ========== LISTS & MEMO ========== */
    const defaultChk = ["è­·ç…§æ­£æœ¬ (æ•ˆæœŸéœ€æ»¿6å€‹æœˆ)", "æ—¥å¹£ç¾é‡‘èˆ‡ä¿¡ç”¨å¡ (JCB)", "ç¶²å¡ / eSIM", "è¿ªå£«å°¼é–€ç¥¨ / é£¯åº—è¨‚å–®", "è¡Œå‹•é›»æºèˆ‡å……é›»ç·š", "å€‹äººå¸¸å‚™è—¥å“", "è¼•ä¾¿é›¨å…·", "å¥½ç©¿çš„é‹å‹•é‹"];
    
    function initLists() {
      const saved = JSON.parse(localStorage.getItem('tk26_chk_new')) || {};
      const html = defaultChk.map((item, i) => {
        const chk = saved[i] ? 'checked' : '';
        const line = saved[i] ? 'line-through text-draw-muted' : 'text-draw-ink';
        return `
          <label class="flex items-center gap-3 p-3 border-b-2 border-dashed border-gray-200 last:border-0 cursor-pointer hover:bg-gray-50 transition-colors">
            <input type="checkbox" onchange="toggleChk(${i}, this)" ${chk} class="w-5 h-5 accent-draw-green border-2 border-draw-ink rounded">
            <span id="chk-txt-${i}" class="${line} transition-colors">${item}</span>
          </label>`;
      }).join('');
      document.getElementById('checklist-box').innerHTML = html;
      
      const memo = localStorage.getItem('tk26_memo_new') || '';
      document.getElementById('memo-input').value = memo;
      renderMemo(memo);
    }

    function toggleChk(i, el) {
      const saved = JSON.parse(localStorage.getItem('tk26_chk_new')) || {};
      saved[i] = el.checked;
      localStorage.setItem('tk26_chk_new', JSON.stringify(saved));
      const txt = document.getElementById(`chk-txt-${i}`);
      if(el.checked) {
          txt.classList.add('line-through', 'text-draw-muted');
          txt.classList.remove('text-draw-ink');
      } else {
          txt.classList.remove('line-through', 'text-draw-muted');
          txt.classList.add('text-draw-ink');
      }
    }

    function saveMemo() {
      const memo = document.getElementById('memo-input').value;
      localStorage.setItem('tk26_memo_new', memo);
      renderMemo(memo);
      showToast('ç­†è¨˜å·²å„²å­˜ ğŸ“');
    }

    function renderMemo(text) {
      const div = document.getElementById('memo-display');
      if(!text.trim()) { div.classList.add('hidden'); return; }
      div.classList.remove('hidden');
      
      // é˜²æ­¢ XSS ä¸¦è½‰æ›ç¶²å€ç‚ºæŒ‰éˆ•
      const safeText = text.replace(/</g, '<').replace(/>/g, '>');
      const urlRegex = /(https?:\/\/[^\s]+)/g;
      div.innerHTML = safeText.replace(urlRegex, function(url) {
          return `<a href="${url}" target="_blank" class="inline-block bg-draw-blue text-white px-3 py-1.5 rounded-lg border-2 border-draw-ink shadow-cartoon-sm my-1 text-[10px] click-effect font-black"><i class="fa-solid fa-link mr-1"></i> å‰å¾€é€£çµ</a>`;
      }).replace(/\n/g, '<br>');
    }

    // åˆå§‹åŒ–åŸ·è¡Œ
    window.onload = () => {
      loadSheet(); // è¼‰å…¥ä½æ–¼ INFO è£¡çš„ Google Sheet
      renderExp();
      initLists();
    };
  </script>
</body>
</html>
